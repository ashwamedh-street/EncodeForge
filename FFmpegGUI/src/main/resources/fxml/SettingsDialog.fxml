<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<StackPane xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1">
    <!-- Main Content -->
    <BorderPane styleClass="dialog-pane" prefWidth="700" prefHeight="600">
        
        <!-- Custom Title Bar -->
        <top>
            <HBox styleClass="custom-title-bar" alignment="CENTER_LEFT">
                <!-- App Icon and Title -->
                <HBox alignment="CENTER_LEFT" spacing="8" styleClass="title-section" onMousePressed="#handleTitleBarPressed" onMouseDragged="#handleTitleBarDragged">
                    <Label fx:id="appIconLabel" styleClass="app-icon"/>
                    <Label text="Settings" styleClass="app-title"/>
                </HBox>
                
                <!-- Draggable spacer area -->
                <Region HBox.hgrow="ALWAYS" onMousePressed="#handleTitleBarPressed" onMouseDragged="#handleTitleBarDragged" styleClass="draggable-spacer"/>
                
                <!-- Window Controls -->
                <HBox spacing="0" styleClass="window-controls">
                    <Button fx:id="minimizeButton" onAction="#handleMinimize" styleClass="window-control-button, minimize-button"/>
                    <Button fx:id="maximizeButton" onAction="#handleMaximize" styleClass="window-control-button, maximize-button"/>
                    <Button fx:id="closeButton" onAction="#handleClose" styleClass="window-control-button, close-button"/>
                </HBox>
            </HBox>
        </top>
    
    <!-- Left: Settings Categories -->
    <left>
        <ListView fx:id="categoryList" styleClass="category-list" prefWidth="180"/>
    </left>
    
    <!-- Center: Settings Content -->
    <center>
        <ScrollPane fitToWidth="true" styleClass="settings-content-scroll">
            <VBox fx:id="settingsContent" spacing="0" styleClass="settings-content">
                <padding>
                    <Insets top="20" right="20" bottom="20" left="20"/>
                </padding>
                
                <!-- General Settings -->
                <VBox fx:id="generalSettings" spacing="20" styleClass="settings-category">
                    <Label text="General Settings" styleClass="category-title"/>
                    
                    <VBox spacing="10">
                        <Label text="Settings Location:" styleClass="setting-label"/>
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Label fx:id="settingsLocationLabel" text="~/.encodeforge/settings.json" styleClass="hint-label" HBox.hgrow="ALWAYS"/>
                            <Button fx:id="openSettingsFolderButton" onAction="#handleOpenSettingsFolder" styleClass="small-button"/>
                        </HBox>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="10">
                        <Label text="Default Output Directory:" styleClass="setting-label"/>
                        <HBox spacing="10">
                            <TextField fx:id="outputDirField" HBox.hgrow="ALWAYS" promptText="Same as source"/>
                            <Button text="Browse..." onAction="#handleBrowseOutputDir" styleClass="small-button"/>
                        </HBox>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="12">
                        <Label text="Options:" styleClass="subsection-title"/>
                        <CheckBox fx:id="deleteOriginalCheck" text="Delete original files after successful conversion"/>
                        <CheckBox fx:id="overwriteCheck" text="Overwrite existing output files"/>
                        <CheckBox fx:id="preserveDateCheck" text="Preserve file creation/modification dates"/>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="10">
                        <Label text="Concurrent Conversions:" styleClass="setting-label"/>
                        <Spinner fx:id="concurrentSpinner" editable="true" min="1" max="8" initialValue="1" prefWidth="100"/>
                    </VBox>
                </VBox>
                
                <!-- FFmpeg Settings -->
                <VBox fx:id="ffmpegSettings" spacing="20" styleClass="settings-category" visible="false" managed="false">
                    <Label text="FFmpeg Configuration" styleClass="category-title"/>
                    
                    <VBox spacing="12">
                        <Label text="Status:" styleClass="subsection-title"/>
                        <Label fx:id="ffmpegVersionLabel" text="Checking..." styleClass="version-label"/>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="10">
                        <Label text="FFmpeg Path:" styleClass="setting-label"/>
                        <HBox spacing="10">
                            <TextField fx:id="ffmpegPathField" HBox.hgrow="ALWAYS" promptText="Auto-detect"/>
                            <Button text="Browse..." onAction="#handleBrowseFFmpeg" styleClass="small-button"/>
                        </HBox>
                        <Label text="Leave empty for automatic detection" styleClass="hint-label"/>
                    </VBox>
                    
                    <VBox spacing="10">
                        <Label text="FFprobe Path:" styleClass="setting-label"/>
                        <HBox spacing="10">
                            <TextField fx:id="ffprobePathField" HBox.hgrow="ALWAYS" promptText="Auto-detect"/>
                            <Button text="Browse..." onAction="#handleBrowseFFprobe" styleClass="small-button"/>
                        </HBox>
                        <Label text="Usually in the same folder as FFmpeg" styleClass="hint-label"/>
                    </VBox>
                    
                    <Separator/>
                    
                    <HBox spacing="12">
                        <Button fx:id="autoDetectButton" onAction="#handleAutoDetect" styleClass="primary-button"/>
                        <Button fx:id="downloadFFmpegButton" onAction="#handleDownloadFFmpeg" styleClass="secondary-button"/>
                    </HBox>
                </VBox>
                
                <!-- Video Settings -->
                <VBox fx:id="videoSettings" spacing="15" styleClass="settings-category" visible="false" managed="false">
                    <Label text="Video Encoding" styleClass="category-title"/>
                    
                    <VBox spacing="8">
                        <Label text="Output Format:" styleClass="setting-label"/>
                        <ComboBox fx:id="outputFormatCombo" maxWidth="Infinity"/>
                    </VBox>
                    
                    <VBox spacing="8">
                        <Label text="Video Codec:" styleClass="setting-label"/>
                        <ComboBox fx:id="videoCodecCombo" maxWidth="Infinity"/>
                    </VBox>
                    
                    <CheckBox fx:id="hwDecodeCheck" text="Enable hardware-accelerated decoding (GPU)"/>
                    
                    <VBox spacing="8">
                        <Label text="Quality Preset:" styleClass="setting-label"/>
                        <ComboBox fx:id="qualityPresetCombo" maxWidth="Infinity"/>
                    </VBox>
                    
                    <VBox spacing="8">
                        <Label text="CRF/CQ Value (Lower = Better Quality):" styleClass="setting-label"/>
                        <Spinner fx:id="crfSpinner" editable="true" min="0" max="51" initialValue="23"/>
                    </VBox>
                </VBox>
                
                <!-- Audio Settings -->
                <VBox fx:id="audioSettings" spacing="20" styleClass="settings-category" visible="false" managed="false">
                    <Label text="Audio Configuration" styleClass="category-title"/>
                    
                    <VBox spacing="10">
                        <Label text="Audio Codec:" styleClass="setting-label"/>
                        <ComboBox fx:id="audioCodecCombo" maxWidth="Infinity"/>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="12">
                        <Label text="Audio Track Selection:" styleClass="subsection-title"/>
                        <RadioButton fx:id="audioAllTracksRadio" text="Keep all audio tracks" toggleGroup="$audioTrackGroup" selected="true"/>
                        <RadioButton fx:id="audioFirstTrackRadio" text="Keep first track only" toggleGroup="$audioTrackGroup"/>
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <RadioButton fx:id="audioLanguageRadio" text="Keep by language:" toggleGroup="$audioTrackGroup"/>
                            <TextField fx:id="audioLanguageField" promptText="e.g., eng,jpn,spa" disable="true" prefWidth="200"/>
                        </HBox>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="10">
                        <Label text="Audio Bitrate:" styleClass="setting-label"/>
                        <ComboBox fx:id="audioBitrateCombo" maxWidth="Infinity"/>
                    </VBox>
                </VBox>
                
                <!-- Subtitle Settings -->
                <VBox fx:id="subtitleSettings" spacing="20" styleClass="settings-category" visible="false" managed="false">
                    <Label text="Subtitle Configuration" styleClass="category-title"/>
                    <Label text="Configure subtitle download, generation, and embedding options" styleClass="hint-label"/>
                    
                    <VBox spacing="12">
                        <CheckBox fx:id="convertSubsCheck" text="Convert/embed subtitles during encoding" selected="true"/>
                        
                        <VBox spacing="10">
                            <Label text="Subtitle Format:" styleClass="setting-label"/>
                            <ComboBox fx:id="subtitleFormatCombo" maxWidth="Infinity"/>
                            <Label text="Format used when embedding or converting subtitles" styleClass="hint-label"/>
                        </VBox>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="12">
                        <Label text="AI Subtitle Generation (Whisper)" styleClass="subsection-title"/>
                        <Label text="Generate subtitles using OpenAI Whisper AI when none are available" styleClass="hint-label"/>
                        
                        <VBox spacing="10">
                            <VBox spacing="8">
                                <Label text="Whisper Model:" styleClass="setting-label"/>
                                <ComboBox fx:id="whisperModelCombo" maxWidth="Infinity"/>
                                <Label text="Larger models are more accurate but slower. 'base' is recommended for most users." styleClass="hint-label"/>
                            </VBox>
                        </VBox>
                    </VBox>
                    
                    <Separator/>
                    
        <VBox spacing="12">
            <Label text="Subtitle Download Providers" styleClass="subsection-title"/>
            <Label text="Download subtitles from multiple free sources. OpenSubtitles API key is optional but recommended." styleClass="hint-label"/>
            
            <VBox spacing="4" style="-fx-padding: 8; -fx-background-color: rgba(76, 201, 176, 0.1); -fx-background-radius: 4;">
                <Label text="✅ Supported Providers (10 total - including anime!):" style="-fx-font-weight: bold; -fx-text-fill: #4ec9b0;"/>
                <Label text="General Providers:" style="-fx-font-weight: bold; -fx-text-fill: #4ec9b0; -fx-padding: 4 0 0 0;"/>
                <Label text="  • OpenSubtitles.com (API) - Best quality, requires API key" styleClass="hint-label"/>
                <Label text="  • Addic7ed - Excellent for TV shows" styleClass="hint-label"/>
                <Label text="  • SubDL - Movies and TV shows with free API" styleClass="hint-label"/>
                <Label text="  • Subf2m - Movies and TV shows" styleClass="hint-label"/>
                <Label text="  • YIFY Subtitles - Movies only" styleClass="hint-label"/>
                <Label text="  • Podnapisi - Multilingual support" styleClass="hint-label"/>
                <Label text="  • SubDivX - Spanish subtitles only" styleClass="hint-label"/>
                <Label text="Anime Providers:" style="-fx-font-weight: bold; -fx-text-fill: #ce9178; -fx-padding: 4 0 0 0;"/>
                <Label text="  • Kitsunekko - Japanese anime subtitles (ASS format)" styleClass="hint-label"/>
                <Label text="  • Jimaku - Modern anime subtitle search (JP/EN)" styleClass="hint-label"/>
                <Label text="  • AnimeSubtitles - Multi-language anime subtitles" styleClass="hint-label"/>
            </VBox>
            
            <Separator/>
                        
                        <Label text="OpenSubtitles.com (Recommended)" styleClass="setting-label" style="-fx-font-weight: bold;"/>
                        <VBox spacing="8">
                            <Label text="API Key (Required):" styleClass="setting-label"/>
                            <TextField fx:id="opensubtitlesApiKeyField" promptText="Enter your API key"/>
                            <Label text="⚠️ API key is required. Get a free key at https://www.opensubtitles.com/consumers" styleClass="hint-label" style="-fx-text-fill: orange;"/>
                        </VBox>
                        
                        <VBox spacing="8">
                            <Label text="Username (Optional):" styleClass="setting-label"/>
                            <TextField fx:id="opensubtitlesUsernameField" promptText="Optional - for extended features"/>
                            <Label text="Username/password provide extended features but are not required" styleClass="hint-label"/>
                        </VBox>
                        
                        <VBox spacing="8">
                            <Label text="Password (Optional):" styleClass="setting-label"/>
                            <PasswordField fx:id="opensubtitlesPasswordField" promptText="Optional - for extended features"/>
                        </VBox>
                        
                        <HBox spacing="10">
                            <Button fx:id="validateOpenSubsButton" onAction="#handleValidateOpenSubtitles" styleClass="small-button"/>
                            <Label fx:id="openSubsValidationLabel" text="" styleClass="hint-label"/>
                        </HBox>
                        
                        <Separator/>
                        
                        <Label text="Other Providers" styleClass="setting-label" style="-fx-font-weight: bold;"/>
                        <Label text="✅ OpenSubtitles.org REST API - No configuration required (free, no limits)" styleClass="hint-label"/>
                        <Label text="✅ YIFY Subtitles - No configuration required (good for movies)" styleClass="hint-label"/>
                        <Label text="⚙️ Podnapisi.NET - Automatically searched (no config)" styleClass="hint-label"/>
                        <Label text="⚙️ SubDivX - Automatically searched for Spanish content (no config)" styleClass="hint-label"/>
                    </VBox>
                </VBox>
                
                <!-- Metadata Settings (New) -->
                <VBox fx:id="metadataSettings" spacing="20" styleClass="settings-category" visible="false" managed="false">
                    <Label text="Metadata &amp; Renaming" styleClass="category-title"/>
                    <Label text="Configure metadata providers for automatic file renaming" styleClass="hint-label"/>
                    
                    <VBox spacing="12">
                        <Label text="Metadata Providers" styleClass="subsection-title"/>
                        
                        <VBox spacing="8">
                            <Label text="TMDB API Key:" styleClass="setting-label"/>
                            <TextField fx:id="tmdbApiKeyField" promptText="Required for movie/TV metadata"/>
                            <Label text="Get free API key from https://www.themoviedb.org/settings/api" styleClass="hint-label"/>
                            <HBox spacing="10">
                                <Button fx:id="validateTMDBButton" onAction="#handleValidateTMDB" styleClass="small-button"/>
                                <Label fx:id="tmdbValidationLabel" text="" styleClass="hint-label"/>
                            </HBox>
                        </VBox>
                        
                        <VBox spacing="8">
                            <Label text="TVDB API Key:" styleClass="setting-label"/>
                            <TextField fx:id="tvdbApiKeyField" promptText="Optional - for TV show metadata"/>
                            <Label text="Get free API key from https://thetvdb.com/api-information" styleClass="hint-label"/>
                            <HBox spacing="10">
                                <Button fx:id="validateTVDBButton" onAction="#handleValidateTVDB" styleClass="small-button"/>
                                <Label fx:id="tvdbValidationLabel" text="" styleClass="hint-label"/>
                            </HBox>
                        </VBox>
                        
                        <Label text="AniList does not require an API key and is always available" styleClass="hint-label"/>
                    </VBox>
                </VBox>
                
                <!-- Output Settings -->
                <VBox fx:id="outputSettings" spacing="15" styleClass="settings-category" visible="false" managed="false">
                    <Label text="Output Settings" styleClass="category-title"/>
                    <Label text="Configure output file handling and metadata options" styleClass="hint-label"/>
                    
                    <VBox spacing="12">
                        <Label text="File Metadata" styleClass="subsection-title"/>
                        <CheckBox fx:id="copyMetadataCheck" text="Copy metadata from source file" selected="true"/>
                        <Label text="Preserve title, language, and other metadata tags" styleClass="hint-label"/>
                        <CheckBox fx:id="stripMetadataCheck" text="Strip unnecessary metadata"/>
                        <Label text="Remove creation date, encoding software tags, and other non-essential metadata" styleClass="hint-label"/>
                    </VBox>
                </VBox>
                
                <!-- Advanced Settings -->
                <VBox fx:id="advancedSettings" spacing="15" styleClass="settings-category" visible="false" managed="false">
                    <Label text="Advanced Options" styleClass="category-title"/>
                    
                    <VBox spacing="8">
                        <Label text="Custom FFmpeg Arguments:" styleClass="setting-label"/>
                        <TextArea fx:id="customArgsArea" promptText="Additional FFmpeg arguments (advanced users only)" prefRowCount="3"/>
                    </VBox>
                    
                    <CheckBox fx:id="twoPassCheck" text="Enable two-pass encoding (slower, better quality)"/>
                    <CheckBox fx:id="fastStartCheck" text="Enable fast start for web playback" selected="true"/>
                    
                    <VBox spacing="8">
                        <Label text="Thread Count:" styleClass="setting-label"/>
                        <Spinner fx:id="threadSpinner" editable="true" min="0" max="32" initialValue="0"/>
                        <Label text="0 = Auto-detect" styleClass="hint-label"/>
                    </VBox>
                </VBox>
                
            </VBox>
        </ScrollPane>
    </center>
    
    <!-- Bottom: Action Buttons -->
    <bottom>
        <HBox spacing="10" alignment="CENTER_RIGHT" styleClass="dialog-buttons">
            <padding>
                <Insets top="15" right="15" bottom="15" left="15"/>
            </padding>
            <Button text="Restore Defaults" onAction="#handleRestoreDefaults" styleClass="secondary-button"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button text="Cancel" onAction="#handleCancel" styleClass="secondary-button"/>
            <Button text="Apply" onAction="#handleApply" styleClass="primary-button"/>
            <Button text="OK" onAction="#handleOK" styleClass="primary-button" defaultButton="true"/>
        </HBox>
    </bottom>
    
    </BorderPane>
</StackPane>

