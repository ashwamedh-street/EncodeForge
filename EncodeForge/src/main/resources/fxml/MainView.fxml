<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.String?>
<?import javafx.collections.FXCollections?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>

<VBox xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1" styleClass="root-pane">
    
    <!-- Top: Title Bar (Full Width) -->
    <HBox styleClass="custom-title-bar" alignment="CENTER_LEFT">
        <!-- App Icon and Title -->
        <HBox alignment="CENTER_LEFT" spacing="8" styleClass="title-section" onMousePressed="#handleTitleBarPressed" onMouseDragged="#handleTitleBarDragged">
            <Label fx:id="appIconLabel" styleClass="app-icon"/>
            <Label text="EncodeForge" styleClass="app-title"/>
        </HBox>
        
        <!-- Menu Bar -->
        <MenuBar styleClass="main-menu-bar" HBox.hgrow="ALWAYS" onMousePressed="#handleTitleBarPressed" onMouseDragged="#handleTitleBarDragged">
            <Menu text="File">
                <MenuItem text="Add Files..." onAction="#handleAddFiles">
                    <accelerator>
                        <javafx.scene.input.KeyCodeCombination alt="UP" code="O" control="DOWN" meta="UP" shift="UP" shortcut="UP"/>
                    </accelerator>
                </MenuItem>
                <MenuItem text="Add Folder..." onAction="#handleAddFolder">
                    <accelerator>
                        <javafx.scene.input.KeyCodeCombination alt="UP" code="O" control="DOWN" meta="UP" shift="DOWN" shortcut="UP"/>
                    </accelerator>
                </MenuItem>
                <SeparatorMenuItem/>
                <MenuItem text="Clear Queue" onAction="#handleClearQueue"/>
                <MenuItem text="Remove Selected" onAction="#handleRemoveSelected"/>
                <SeparatorMenuItem/>
                <MenuItem text="Open Output Folder" onAction="#handleOpenOutputFolder"/>
                <SeparatorMenuItem/>
                <MenuItem text="Exit" onAction="#handleExit">
                    <accelerator>
                        <javafx.scene.input.KeyCodeCombination alt="DOWN" code="F4" control="UP" meta="UP" shift="UP" shortcut="UP"/>
                    </accelerator>
                </MenuItem>
            </Menu>
            <Menu text="Edit">
                <MenuItem text="Select All" onAction="#handleSelectAll">
                    <accelerator>
                        <javafx.scene.input.KeyCodeCombination alt="UP" code="A" control="DOWN" meta="UP" shift="UP" shortcut="UP"/>
                    </accelerator>
                </MenuItem>
                <MenuItem text="Deselect All" onAction="#handleDeselectAll"/>
                <SeparatorMenuItem/>
                <MenuItem text="Settings..." onAction="#handleSettings">
                    <accelerator>
                        <javafx.scene.input.KeyCodeCombination alt="UP" code="COMMA" control="DOWN" meta="UP" shift="UP" shortcut="UP"/>
                    </accelerator>
                </MenuItem>
            </Menu>
            <Menu text="Tools">
                <MenuItem text="Batch Rename..." onAction="#handleBatchRename"/>
                <MenuItem text="Extract Subtitles..." onAction="#handleExtractSubtitles"/>
                <SeparatorMenuItem/>
                <MenuItem text="Setup AI Subtitles..." onAction="#handleConfigureWhisper"/>
                <SeparatorMenuItem/>
                <MenuItem text="Check FFmpeg Status" onAction="#handleCheckFFmpeg"/>
                <MenuItem text="Download FFmpeg" onAction="#handleDownloadFFmpeg"/>
                <SeparatorMenuItem/>
                <MenuItem text="Open Logs Folder" onAction="#handleOpenLogsFolder"/>
                <MenuItem text="Open Settings Folder" onAction="#handleOpenSettingsFolder"/>
            </Menu>
            <Menu text="Help">
                <MenuItem text="Documentation" onAction="#handleDocumentation">
                    <accelerator>
                        <javafx.scene.input.KeyCodeCombination alt="UP" code="F1" control="UP" meta="UP" shift="UP" shortcut="UP"/>
                    </accelerator>
                </MenuItem>
                <MenuItem text="View Logs" onAction="#handleViewLogs"/>
                <SeparatorMenuItem/>
                <MenuItem text="Check for Updates..." onAction="#handleCheckForUpdates"/>
                <MenuItem text="Report Issue..." onAction="#handleReportIssue"/>
                <SeparatorMenuItem/>
                <MenuItem text="About EncodeForge" onAction="#handleAbout"/>
            </Menu>
        </MenuBar>
        
        <!-- Draggable spacer area -->
        <Region HBox.hgrow="ALWAYS" onMousePressed="#handleTitleBarPressed" onMouseDragged="#handleTitleBarDragged" styleClass="draggable-spacer"/>
        
        <!-- Window Controls -->
        <HBox spacing="0" styleClass="window-controls">
            <Button fx:id="minimizeButton" onAction="#handleMinimize" styleClass="window-control-button, minimize-button"/>
            <Button fx:id="maximizeButton" onAction="#handleMaximize" styleClass="window-control-button, maximize-button"/>
            <Button fx:id="closeButton" onAction="#handleClose" styleClass="window-control-button, close-button"/>
        </HBox>
    </HBox>
    
    <!-- Main Content Area with Sidebar -->
    <HBox VBox.vgrow="ALWAYS">
        
        <!-- Left: Sidebar -->
        <VBox fx:id="sidebar" styleClass="sidebar" prefWidth="150" minWidth="140" maxWidth="160">
            <padding>
                <Insets top="15" right="12" bottom="15" left="12"/>
            </padding>
            
            <!-- Mode Selection -->
            <VBox spacing="8" styleClass="mode-selection">
                <Label text="Modes" styleClass="sidebar-section-title"/>
                
                <!-- Encoder Mode -->
                <Button fx:id="encoderModeButton" onAction="#handleEncoderMode" styleClass="mode-button, selected" maxWidth="Infinity">
                    <graphic>
                        <HBox alignment="CENTER_LEFT" spacing="8">
                            <Label text="ðŸŽ¬" styleClass="mode-icon"/>
                            <Label text="Encoder" styleClass="mode-label"/>
                        </HBox>
                    </graphic>
                </Button>
                
                <!-- Subtitle Mode -->
                <Button fx:id="subtitleModeButton" onAction="#handleSubtitleMode" styleClass="mode-button" maxWidth="Infinity">
                    <graphic>
                        <HBox alignment="CENTER_LEFT" spacing="8">
                            <Label text="ðŸ“" styleClass="mode-icon"/>
                            <Label text="Subtitles" styleClass="mode-label"/>
                        </HBox>
                    </graphic>
                </Button>
                
                <!-- Metadata Mode -->
                <Button fx:id="renamerModeButton" onAction="#handleRenamerMode" styleClass="mode-button" maxWidth="Infinity">
                    <graphic>
                        <HBox alignment="CENTER_LEFT" spacing="8">
                            <Label text="ðŸ“" styleClass="mode-icon"/>
                            <Label text="Metadata" styleClass="mode-label"/>
                        </HBox>
                    </graphic>
                </Button>
            </VBox>
            
            <!-- Separator -->
            <Separator styleClass="sidebar-separator"/>
            
            <!-- File Operations -->
            <VBox spacing="8" styleClass="file-operations">
                <Label text="Files" styleClass="sidebar-section-title"/>
                
                <!-- Add Files -->
                <Button fx:id="addFilesButton" onAction="#handleAddFiles" styleClass="mode-button" maxWidth="Infinity">
                    <graphic>
                        <HBox alignment="CENTER_LEFT" spacing="8">
                            <Label text="ðŸ“„" styleClass="mode-icon"/>
                            <Label text="Add Files" styleClass="mode-label"/>
                        </HBox>
                    </graphic>
                </Button>
                
                <!-- Add Folder -->
                <Button fx:id="addFolderButton" onAction="#handleAddFolder" styleClass="mode-button" maxWidth="Infinity">
                    <graphic>
                        <HBox alignment="CENTER_LEFT" spacing="8">
                            <Label text="ðŸ“‚" styleClass="mode-icon"/>
                            <Label text="Add Folder" styleClass="mode-label"/>
                        </HBox>
                    </graphic>
                </Button>
            </VBox>
            
            <!-- Spacer to push content to top -->
            <Region VBox.vgrow="ALWAYS"/>
            
            <!-- Separator -->
            <Separator styleClass="sidebar-separator"/>
            
            <!-- Settings -->
            <VBox spacing="8" styleClass="settings-section">
                <Label text="System" styleClass="sidebar-section-title"/>
                
                <!-- Logs Button -->
                <Button fx:id="logsButton" onAction="#handleLogsMode" styleClass="mode-button" maxWidth="Infinity">
                    <graphic>
                        <HBox alignment="CENTER_LEFT" spacing="8">
                            <Label text="ðŸ“‹" styleClass="mode-icon"/>
                            <Label text="Logs" styleClass="mode-label"/>
                        </HBox>
                    </graphic>
                </Button>
                
                <!-- Settings Button -->
                <Button fx:id="settingsButton" onAction="#handleSettingsMode" styleClass="mode-button" maxWidth="Infinity">
                    <graphic>
                        <HBox alignment="CENTER_LEFT" spacing="8">
                            <Label text="âš™ï¸" styleClass="mode-icon"/>
                            <Label text="Settings" styleClass="mode-label"/>
                        </HBox>
                    </graphic>
                </Button>
            </VBox>
        </VBox>
        
        <!-- Right: Main Content Area -->
        <BorderPane HBox.hgrow="ALWAYS">
        
        <!-- Top: Mode-Specific Quick Settings Panel -->
        <top>
            <VBox fx:id="modeSpecificPanel" styleClass="mode-panel">
                <!-- Encoder Quick Settings -->
                <VBox fx:id="encoderQuickSettings" spacing="10" styleClass="quick-settings" managed="false" visible="false">
                    <padding>
                        <Insets top="15" right="15" bottom="15" left="15"/>
                    </padding>
                    
                    <!-- Row 1: Video Settings -->
                    <HBox spacing="15" alignment="CENTER_LEFT">
                        <VBox spacing="4" styleClass="settings-group">
                            <Label text="Video Settings" styleClass="group-label"/>
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="Format:" styleClass="setting-label"/>
                                <ComboBox fx:id="quickFormatCombo" styleClass="quick-combo" prefWidth="100"/>
                                <Label text="Codec:" styleClass="setting-label"/>
                                <ComboBox fx:id="quickCodecCombo" styleClass="quick-combo" prefWidth="160"/>
                                <Label text="Quality:" styleClass="setting-label"/>
                                <ComboBox fx:id="quickQualityCombo" styleClass="quick-combo" prefWidth="160"/>
                                <Label text="Preset:" styleClass="setting-label"/>
                                <ComboBox fx:id="quickPresetCombo" styleClass="quick-combo" prefWidth="120"/>
                            </HBox>
                        </VBox>
                        
                        <Region HBox.hgrow="ALWAYS"/>
                        
                        <!-- Control Buttons -->
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Button fx:id="startButton" onAction="#handleStartProcessing" styleClass="toolbar-button, primary-button" disable="true" prefWidth="160"/>
                            <Button fx:id="pauseButton" onAction="#handlePause" styleClass="toolbar-button" disable="true" prefWidth="110"/>
                            <Button fx:id="stopButton" onAction="#handleStop" styleClass="toolbar-button" disable="true" prefWidth="110"/>
                            <Label fx:id="statusLabel" text="Ready" styleClass="status-label" prefWidth="150"/>
                        </HBox>
                    </HBox>
                    
                    <!-- Row 2: Processing Options -->
                    <HBox spacing="15" alignment="CENTER_LEFT">
                        <VBox spacing="6" styleClass="settings-group">
                            <Label text="Processing Options" styleClass="group-label"/>
                            <HBox spacing="15">
                                <CheckBox fx:id="quickHwAccelCheck" text="Hardware Acceleration" styleClass="quick-check" selected="true"/>
                                <CheckBox fx:id="quickAudioNormalizeCheck" text="Normalize Audio" styleClass="quick-check"/>
                                <CheckBox fx:id="quickDownloadSubsCheck" text="Download Subtitles" styleClass="quick-check" disable="true"/>
                                <CheckBox fx:id="quickRenameCheck" text="Rename Files" styleClass="quick-check" disable="true"/>
                            </HBox>
                        </VBox>
                        
                        <Separator orientation="VERTICAL"/>
                        
                        <VBox spacing="4" styleClass="settings-group">
                            <Label text="Configure" styleClass="group-label"/>
                            <HBox spacing="10">
                                <Button fx:id="configSubtitlesButton" onAction="#handleConfigureSubtitles" styleClass="small-button" prefWidth="110" disable="true"/>
                                <Button fx:id="configRenamerButton" onAction="#handleConfigureRenamer" styleClass="small-button" prefWidth="110" disable="true"/>
                            </HBox>
                        </VBox>
                    </HBox>
                </VBox>
                
                <!-- Subtitle Quick Settings -->
                <VBox fx:id="subtitleQuickSettings" spacing="10" styleClass="quick-settings" managed="false" visible="false">
                    <padding>
                        <Insets top="15" right="15" bottom="15" left="15"/>
                    </padding>
                    
                    <!-- Row 1: Mode and Language Selection -->
                    <HBox spacing="15" alignment="CENTER_LEFT">
                        <VBox spacing="4" styleClass="settings-group">
                            <Label text="Mode" styleClass="group-label"/>
                            <ComboBox fx:id="quickSubProviderCombo" styleClass="quick-combo" prefWidth="250">
                                <tooltip>
                                    <Tooltip text="Searches 10 subtitle providers:&#10;âœ… OpenSubtitles.com (API key)&#10;âœ… Addic7ed (TV shows)&#10;âœ… SubDL (Movies &amp; TV)&#10;âœ… Subf2m (Movies &amp; TV)&#10;âœ… YIFY (Movies only)&#10;âœ… Podnapisi (Multilingual)&#10;âœ… SubDivX (Spanish)&#10;ðŸŽŒ Kitsunekko (Anime - Japanese)&#10;ðŸŽŒ Jimaku (Anime - JP/EN)&#10;ðŸŽŒ AnimeSubtitles (Anime - Multi)&#10;&#10;AI generation uses Whisper"/>
                                </tooltip>
                            </ComboBox>
                        </VBox>
                        
                        <Separator orientation="VERTICAL"/>
                        
                        <VBox spacing="4" styleClass="settings-group">
                            <Label text="Languages (Select Multiple)" styleClass="group-label"/>
                            <VBox spacing="6">
                                <!-- Row 1: Major European Languages -->
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <CheckBox fx:id="langEnglishCheck" text="ðŸ‡¬ðŸ‡§ English" selected="true"/>
                                    <CheckBox fx:id="langSpanishCheck" text="ðŸ‡ªðŸ‡¸ Spanish (EU)"/>
                                    <CheckBox fx:id="langSpanishLACheck" text="ðŸ‡²ðŸ‡½ Spanish (LA)"/>
                                    <CheckBox fx:id="langFrenchCheck" text="ðŸ‡«ðŸ‡· French"/>
                                    <CheckBox fx:id="langGermanCheck" text="ðŸ‡©ðŸ‡ª German"/>
                                    <CheckBox fx:id="langItalianCheck" text="ðŸ‡®ðŸ‡¹ Italian"/>
                                    <CheckBox fx:id="langPortugueseCheck" text="ðŸ‡µðŸ‡¹ Portuguese (EU)"/>
                                    <CheckBox fx:id="langPortugueseBRCheck" text="ðŸ‡§ðŸ‡· Portuguese (BR)"/>
                                </HBox>
                                <!-- Row 2: Asian Languages -->
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <CheckBox fx:id="langJapaneseCheck" text="ðŸ‡¯ðŸ‡µ Japanese"/>
                                    <CheckBox fx:id="langChineseCheck" text="ðŸ‡¨ðŸ‡³ Chinese (Simp)"/>
                                    <CheckBox fx:id="langChineseTWCheck" text="ðŸ‡¹ðŸ‡¼ Chinese (Trad)"/>
                                    <CheckBox fx:id="langKoreanCheck" text="ðŸ‡°ðŸ‡· Korean"/>
                                    <CheckBox fx:id="langHindiCheck" text="ðŸ‡®ðŸ‡³ Hindi"/>
                                    <CheckBox fx:id="langThaiCheck" text="ðŸ‡¹ðŸ‡­ Thai"/>
                                    <CheckBox fx:id="langVietnameseCheck" text="ðŸ‡»ðŸ‡³ Vietnamese"/>
                                </HBox>
                                <!-- Row 3: Other Major Languages -->
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <CheckBox fx:id="langRussianCheck" text="ðŸ‡·ðŸ‡º Russian"/>
                                    <CheckBox fx:id="langArabicCheck" text="ðŸ‡¸ðŸ‡¦ Arabic"/>
                                    <CheckBox fx:id="langTurkishCheck" text="ðŸ‡¹ðŸ‡· Turkish"/>
                                    <CheckBox fx:id="langPolishCheck" text="ðŸ‡µðŸ‡± Polish"/>
                                    <CheckBox fx:id="langDutchCheck" text="ðŸ‡³ðŸ‡± Dutch"/>
                                    <CheckBox fx:id="langSwedishCheck" text="ðŸ‡¸ðŸ‡ª Swedish"/>
                                    <CheckBox fx:id="langNorwegianCheck" text="ðŸ‡³ðŸ‡´ Norwegian"/>
                                </HBox>
                            </VBox>
                        </VBox>
                        
                        <Region HBox.hgrow="ALWAYS"/>
                        
                        <!-- Control Buttons -->
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Button fx:id="subtitleProcessButton" onAction="#handleProcessSubtitles" styleClass="toolbar-button, primary-button" prefWidth="140"/>
                        </HBox>
                    </HBox>
                    
                    <!-- Row 2: Provider Status and Selected Files -->
                    <HBox spacing="15" alignment="CENTER_LEFT">
                        <VBox spacing="4" styleClass="settings-group">
                            <Label text="Providers" styleClass="group-label"/>
                            <HBox spacing="10">
                                <Button fx:id="whisperStatusButton" text="ðŸ¤– Whisper: Not Setup" onAction="#handleConfigureWhisper" styleClass="provider-status-button" prefWidth="180"/>
                                <Button fx:id="openSubsStatusButton" text="ðŸŒ OpenSubtitles: Not Setup" onAction="#handleConfigureOpenSubtitles" styleClass="provider-status-button" prefWidth="200"/>
                            </HBox>
                        </VBox>
                        
                        <Separator orientation="VERTICAL"/>
                        
                        <VBox spacing="4" styleClass="settings-group" HBox.hgrow="ALWAYS">
                            <Label text="Selected Files" styleClass="group-label"/>
                            <Label fx:id="subtitleSelectedFilesLabel" text="No files selected" styleClass="info-label"/>
                        </VBox>
                    </HBox>
                </VBox>
                
                <!-- Metadata Quick Settings -->
                <VBox fx:id="renamerQuickSettings" spacing="10" styleClass="quick-settings" managed="false" visible="false">
                    <padding>
                        <Insets top="15" right="15" bottom="15" left="15"/>
                    </padding>
                    
                    <!-- Row 1: Settings and Control Buttons -->
                    <HBox spacing="15" alignment="CENTER_LEFT">
                        <VBox spacing="4" styleClass="settings-group">
                            <Label text="Settings" styleClass="group-label"/>
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="Provider:" styleClass="setting-label"/>
                                <ComboBox fx:id="quickRenameProviderCombo" styleClass="quick-combo" prefWidth="150"/>
                                <Button fx:id="formatPatternButton" onAction="#handleOpenFormatter" styleClass="small-button" prefWidth="160"/>
                            </HBox>
                        </VBox>
                        
                        <Region HBox.hgrow="ALWAYS"/>
                        
                        <!-- Control Buttons -->
                        <HBox spacing="10">
                            <Button fx:id="searchMetadataButton" text="ðŸ” Search" onAction="#handleRefreshMetadata" styleClass="toolbar-button" prefWidth="130">
                                <tooltip>
                                    <Tooltip text="Search metadata providers for file information"/>
                                </tooltip>
                            </Button>
                            <Button fx:id="applyRenameButton" text="âœ… Apply Changes" onAction="#handleApplyRename" styleClass="toolbar-button, primary-button" prefWidth="160" disable="true">
                                <tooltip>
                                    <Tooltip text="Apply the rename changes to selected files"/>
                                </tooltip>
                            </Button>
                        </HBox>
                    </HBox>
                    
                    <!-- Row 2: Provider Status -->
                    <VBox spacing="8">
                        <HBox spacing="15" alignment="CENTER_LEFT">
                            <VBox spacing="4" styleClass="settings-group">
                                <Label text="API Key Providers (Free Keys)" styleClass="group-label"/>
                                <HBox spacing="10">
                                    <Button fx:id="tmdbStatusButton" onAction="#handleConfigureTMDB" styleClass="provider-status-button" prefWidth="140">
                                        <tooltip>
                                            <Tooltip text="TMDB - Movies &amp; TV shows. Click to configure API key."/>
                                        </tooltip>
                                    </Button>
                                    <Button fx:id="tvdbStatusButton" onAction="#handleConfigureTVDB" styleClass="provider-status-button" prefWidth="140">
                                        <tooltip>
                                            <Tooltip text="TVDB - TV shows only. Click to configure API key."/>
                                        </tooltip>
                                    </Button>
                                    <Button fx:id="omdbStatusButton" onAction="#handleSettings" styleClass="provider-status-button" prefWidth="140">
                                        <tooltip>
                                            <Tooltip text="OMDB - Movies &amp; TV. Click to configure API key."/>
                                        </tooltip>
                                    </Button>
                                    <Button fx:id="traktStatusButton" onAction="#handleSettings" styleClass="provider-status-button" prefWidth="140">
                                        <tooltip>
                                            <Tooltip text="Trakt - Movies &amp; TV tracking. Click to configure API key."/>
                                        </tooltip>
                                    </Button>
                                    <Button fx:id="fanartStatusButton" onAction="#handleSettings" styleClass="provider-status-button" prefWidth="140">
                                        <tooltip>
                                            <Tooltip text="Fanart.tv - Media artwork. Click to configure API key."/>
                                        </tooltip>
                                    </Button>
                                </HBox>
                            </VBox>
                            
                            <Separator orientation="VERTICAL"/>
                            
                            <VBox spacing="4" styleClass="settings-group" HBox.hgrow="ALWAYS">
                                <Label text="Selected Files" styleClass="group-label"/>
                                <Label fx:id="renamerSelectedFilesLabel" text="No files selected - add files to get started" styleClass="info-label"/>
                            </VBox>
                        </HBox>
                        
                        <HBox spacing="15" alignment="CENTER_LEFT">
                            <VBox spacing="4" styleClass="settings-group">
                                <Label text="Free Providers (No API Key)" styleClass="group-label"/>
                                <HBox spacing="10">
                                    <Label text="âœ… AniDB (Anime)" styleClass="info-label" style="-fx-text-fill: #4ec9b0; -fx-font-weight: bold;">
                                        <tooltip>
                                            <Tooltip text="AniDB - Always available, no configuration needed"/>
                                        </tooltip>
                                    </Label>
                                    <Label text="âœ… Kitsu (Anime)" styleClass="info-label" style="-fx-text-fill: #4ec9b0; -fx-font-weight: bold;">
                                        <tooltip>
                                            <Tooltip text="Kitsu - Always available, no configuration needed"/>
                                        </tooltip>
                                    </Label>
                                    <Label text="âœ… Jikan/MAL (Anime)" styleClass="info-label" style="-fx-text-fill: #4ec9b0; -fx-font-weight: bold;">
                                        <tooltip>
                                            <Tooltip text="Jikan (MyAnimeList mirror) - Always available, read-only"/>
                                        </tooltip>
                                    </Label>
                                    <Label text="âœ… TVmaze (TV)" styleClass="info-label" style="-fx-text-fill: #4ec9b0; -fx-font-weight: bold;">
                                        <tooltip>
                                            <Tooltip text="TVmaze - Always available for TV shows"/>
                                        </tooltip>
                                    </Label>
                                </HBox>
                            </VBox>
                        </HBox>
                    </VBox>
                </VBox>
            </VBox>
        </top>
    
    <!-- Center: Main Content Area -->
    <center>
        <StackPane fx:id="mainContentStack">
            
            <!-- Encoder Mode Layout -->
            <!-- Encoder Mode Layout - With right file info panel -->
            <HBox fx:id="encoderModeLayout" styleClass="mode-content-container" managed="true" visible="true" HBox.hgrow="ALWAYS">
                
                <!-- Left: Multi-Section Queue with Resizable Sections -->
                <SplitPane fx:id="queueSplitPane" orientation="VERTICAL" dividerPositions="0.4, 0.6" styleClass="queue-split-pane" HBox.hgrow="ALWAYS">
                    
                    <!-- Queued Files Section -->
                    <VBox spacing="0" styleClass="queue-section" minHeight="100">
                        <HBox alignment="CENTER_LEFT" styleClass="section-header, queued-header">
                            <Label text="Queued" styleClass="section-title"/>
                            <Label text="(Drag to reorder)" styleClass="hint-label" style="-fx-padding: 0 0 0 8;"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="queuedCountLabel" text="0 files" styleClass="queue-count"/>
                            <Separator orientation="VERTICAL" style="-fx-padding: 0 10;"/>
                            <Button fx:id="removeQueuedButton" onAction="#handleRemoveQueued" styleClass="toolbar-button" style="-fx-padding: 4 12;"/>
                            <Button fx:id="clearQueuedButton" onAction="#handleClearQueued" styleClass="toolbar-button" style="-fx-padding: 4 12;"/>
                            <padding>
                                <Insets top="8" right="12" bottom="8" left="12"/>
                            </padding>
                        </HBox>
                        
                        <TableView fx:id="queuedTable" VBox.vgrow="ALWAYS" styleClass="queue-table, draggable-table">
                            <columns>
                                <TableColumn fx:id="queuedStatusColumn" text="" prefWidth="35" minWidth="35" maxWidth="35"/>
                                <TableColumn fx:id="queuedFileColumn" text="File Name" prefWidth="300"/>
                                <TableColumn fx:id="queuedOutputColumn" text="Output" prefWidth="70"/>
                                <TableColumn fx:id="queuedSizeColumn" text="Size" prefWidth="80"/>
                            </columns>
                            <contextMenu>
                                <ContextMenu>
                                    <items>
                                        <MenuItem text="Remove" onAction="#handleRemoveQueued"/>
                                        <MenuItem text="Move Up" onAction="#handleMoveUpQueued"/>
                                        <MenuItem text="Move Down" onAction="#handleMoveDownQueued"/>
                                        <SeparatorMenuItem/>
                                        <MenuItem text="Open File Location" onAction="#handleOpenFileLocationQueued"/>
                                    </items>
                                </ContextMenu>
                            </contextMenu>
                            <placeholder>
                                <Label text="No files queued. Add files to begin encoding." styleClass="placeholder-label"/>
                            </placeholder>
                        </TableView>
                    </VBox>
                    
                    <!-- Processing Files Section -->
                    <VBox spacing="0" styleClass="queue-section" minHeight="80">
                        <HBox alignment="CENTER_LEFT" styleClass="section-header, processing-header">
                            <Label text="âš¡ Processing" styleClass="section-title"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="processingCountLabel" text="0 files" styleClass="queue-count"/>
                            <padding>
                                <Insets top="8" right="12" bottom="8" left="12"/>
                            </padding>
                        </HBox>
                        
                        <TableView fx:id="processingTable" VBox.vgrow="ALWAYS" styleClass="queue-table, processing-table">
                            <columns>
                                <TableColumn fx:id="procStatusColumn" text="" prefWidth="35" minWidth="35" maxWidth="35"/>
                                <TableColumn fx:id="procFileColumn" text="File Name" prefWidth="200"/>
                                <TableColumn fx:id="procOperationColumn" text="Status" prefWidth="150"/>
                                <TableColumn fx:id="procProgressColumn" text="Progress" prefWidth="80"/>
                                <TableColumn fx:id="procFpsColumn" text="FPS" prefWidth="60"/>
                                <TableColumn fx:id="procSpeedColumn" text="Speed" prefWidth="70"/>
                                <TableColumn fx:id="procEtaColumn" text="ETA" prefWidth="80"/>
                            </columns>
                            <placeholder>
                                <Label text="No files currently processing." styleClass="placeholder-label"/>
                            </placeholder>
                        </TableView>
                    </VBox>
                    
                    <!-- Completed Files Section -->
                    <VBox spacing="0" styleClass="queue-section" minHeight="100">
                        <HBox alignment="CENTER_LEFT" styleClass="section-header, completed-header">
                            <Label text="Completed" styleClass="section-title"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="completedCountLabel" text="0 files" styleClass="queue-count"/>
                            <Separator orientation="VERTICAL" style="-fx-padding: 0 10;"/>
                            <Button fx:id="clearCompletedButton" onAction="#handleClearCompleted" styleClass="toolbar-button" style="-fx-padding: 4 12;"/>
                            <padding>
                                <Insets top="8" right="12" bottom="8" left="12"/>
                            </padding>
                        </HBox>
                        
                        <TableView fx:id="completedTable" VBox.vgrow="ALWAYS" styleClass="queue-table, completed-table">
                            <columns>
                                <TableColumn fx:id="compStatusColumn" text="" prefWidth="35" minWidth="35" maxWidth="35"/>
                                <TableColumn fx:id="compFileColumn" text="File Name" prefWidth="250"/>
                                <TableColumn fx:id="compOutputColumn" text="Output" prefWidth="70"/>
                                <TableColumn fx:id="compSizeColumn" text="Original" prefWidth="80"/>
                                <TableColumn fx:id="compNewSizeColumn" text="New Size" prefWidth="80"/>
                                <TableColumn fx:id="compTimeColumn" text="Time Taken" prefWidth="90"/>
                            </columns>
                            <contextMenu>
                                <ContextMenu>
                                    <items>
                                        <MenuItem text="Open Output File" onAction="#handleOpenOutputFile"/>
                                        <MenuItem text="Open File Location" onAction="#handleOpenFileLocationCompleted"/>
                                        <SeparatorMenuItem/>
                                        <MenuItem text="Remove from List" onAction="#handleRemoveCompleted"/>
                                    </items>
                                </ContextMenu>
                            </contextMenu>
                            <placeholder>
                                <Label text="No files completed yet." styleClass="placeholder-label"/>
                            </placeholder>
                        </TableView>
                    </VBox>
                </SplitPane>
                
                <!-- Right: File Info Panel (macOS/Windows style) -->
                <VBox fx:id="fileInfoPanel" styleClass="file-info-panel" prefWidth="280" minWidth="250" maxWidth="300">
                    <padding>
                        <Insets top="12" right="12" bottom="12" left="12"/>
                    </padding>
                    
                    <!-- Panel Header -->
                    <HBox alignment="CENTER_LEFT" spacing="8" style="-fx-padding: 0 0 12 0;">
                        <Label text="ðŸ“„ File Info" styleClass="file-info-title" HBox.hgrow="ALWAYS"/>
                        <Button fx:id="toggleFileInfoButton" text="Ã—" styleClass="close-button" onAction="#handleToggleFileInfo" 
                                style="-fx-min-width: 24; -fx-min-height: 24; -fx-font-size: 18; -fx-padding: 0;"/>
                    </HBox>
                    
                    <!-- Info Content -->
                    <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" styleClass="file-info-scroll">
                        <VBox fx:id="fileInfoContent" spacing="16">
                            
                            <!-- File Preview Placeholder -->
                            <VBox fx:id="filePreviewBox" alignment="CENTER" styleClass="file-preview-box" minHeight="150" maxHeight="150" 
                                  style="-fx-background-color: #2a2a2a; -fx-border-color: #3a3a3a; -fx-border-radius: 6; -fx-background-radius: 6;">
                                <ImageView fx:id="filePreviewImage" fitWidth="240" fitHeight="135" preserveRatio="true" visible="false" managed="false"/>
                                <Label fx:id="filePreviewPlaceholder" text="ðŸ“¹" style="-fx-font-size: 48; -fx-opacity: 0.3;"/>
                                <Label fx:id="filePreviewLabel" text="No file selected" styleClass="preview-label" style="-fx-opacity: 0.5;"/>
                            </VBox>
                            
                            <!-- File Name Section -->
                            <VBox spacing="6">
                                <Label text="Name" styleClass="info-label-header"/>
                                <Label fx:id="fileInfoNameLabel" text="â€”" wrapText="true" styleClass="info-label-value"/>
                            </VBox>
                            
                            <!-- File Size -->
                            <HBox spacing="8">
                                <VBox spacing="4" HBox.hgrow="ALWAYS">
                                    <Label text="Size" styleClass="info-label-header"/>
                                    <Label fx:id="fileInfoSizeLabel" text="â€”" styleClass="info-label-value"/>
                                </VBox>
                            </HBox>
                            
                            <!-- Duration -->
                            <HBox spacing="8">
                                <VBox spacing="4" HBox.hgrow="ALWAYS">
                                    <Label text="Duration" styleClass="info-label-header"/>
                                    <Label fx:id="fileInfoDurationLabel" text="â€”" styleClass="info-label-value"/>
                                </VBox>
                            </HBox>
                            
                            <Separator style="-fx-background-color: #3a3a3a;"/>
                            
                            <!-- Video Info Section -->
                            <VBox spacing="6">
                                <Label text="VIDEO" styleClass="info-section-header"/>
                                
                                <HBox spacing="8">
                                    <VBox spacing="4" HBox.hgrow="ALWAYS">
                                        <Label text="Codec" styleClass="info-label-header"/>
                                        <Label fx:id="fileInfoVideoCodecLabel" text="â€”" styleClass="info-label-value"/>
                                    </VBox>
                                </HBox>
                                
                                <HBox spacing="8">
                                    <VBox spacing="4" HBox.hgrow="ALWAYS">
                                        <Label text="Resolution" styleClass="info-label-header"/>
                                        <Label fx:id="fileInfoResolutionLabel" text="â€”" styleClass="info-label-value"/>
                                    </VBox>
                                </HBox>
                                
                                <HBox spacing="8">
                                    <VBox spacing="4" HBox.hgrow="ALWAYS">
                                        <Label text="Frame Rate" styleClass="info-label-header"/>
                                        <Label fx:id="fileInfoFrameRateLabel" text="â€”" styleClass="info-label-value"/>
                                    </VBox>
                                </HBox>
                                
                                <HBox spacing="8">
                                    <VBox spacing="4" HBox.hgrow="ALWAYS">
                                        <Label text="Bitrate" styleClass="info-label-header"/>
                                        <Label fx:id="fileInfoVideoBitrateLabel" text="â€”" styleClass="info-label-value"/>
                                    </VBox>
                                </HBox>
                            </VBox>
                            
                            <Separator style="-fx-background-color: #3a3a3a;"/>
                            
                            <!-- Audio Info Section -->
                            <VBox spacing="6">
                                <Label text="AUDIO" styleClass="info-section-header"/>
                                
                                <HBox spacing="8">
                                    <VBox spacing="4" HBox.hgrow="ALWAYS">
                                        <Label text="Codec" styleClass="info-label-header"/>
                                        <Label fx:id="fileInfoAudioCodecLabel" text="â€”" styleClass="info-label-value"/>
                                    </VBox>
                                </HBox>
                                
                                <HBox spacing="8">
                                    <VBox spacing="4" HBox.hgrow="ALWAYS">
                                        <Label text="Channels" styleClass="info-label-header"/>
                                        <Label fx:id="fileInfoAudioChannelsLabel" text="â€”" styleClass="info-label-value"/>
                                    </VBox>
                                </HBox>
                                
                                <HBox spacing="8">
                                    <VBox spacing="4" HBox.hgrow="ALWAYS">
                                        <Label text="Sample Rate" styleClass="info-label-header"/>
                                        <Label fx:id="fileInfoSampleRateLabel" text="â€”" styleClass="info-label-value"/>
                                    </VBox>
                                </HBox>
                                
                                <HBox spacing="8">
                                    <VBox spacing="4" HBox.hgrow="ALWAYS">
                                        <Label text="Bitrate" styleClass="info-label-header"/>
                                        <Label fx:id="fileInfoAudioBitrateLabel" text="â€”" styleClass="info-label-value"/>
                                    </VBox>
                                </HBox>
                            </VBox>
                            
                            <Separator style="-fx-background-color: #3a3a3a;"/>
                            
                            <!-- File Path -->
                            <VBox spacing="6">
                                <Label text="Path" styleClass="info-label-header"/>
                                <Label fx:id="fileInfoPathLabel" text="â€”" wrapText="true" styleClass="info-label-value" style="-fx-font-size: 11; -fx-opacity: 0.7;"/>
                            </VBox>
                        </VBox>
                    </ScrollPane>
                </VBox>
            </HBox>
            <!-- End Encoder Mode Layout -->
            
            <!-- Subtitle Mode Layout - Full Width without right panel -->
            <VBox fx:id="subtitleModeLayout" styleClass="mode-content-container" managed="false" visible="false">
                
                <!-- Main Content: Subtitle Preview -->
                <BorderPane styleClass="subtitle-main-content">
                    <!-- Top: Header Section -->
                    <top>
                        <VBox spacing="10">
                            <padding>
                                <Insets top="15" right="15" bottom="10" left="15"/>
                            </padding>
                            
                            <Label text="Subtitle Preview" styleClass="preview-title"/>
                            
                            <!-- File Selector -->
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="Current File:" styleClass="setting-label"/>
                                <ComboBox fx:id="subtitleFileCombo" styleClass="preview-combo" prefWidth="400" HBox.hgrow="ALWAYS"/>
                            </HBox>
                            
                            <Separator/>
                        </VBox>
                    </top>
                    
                    <!-- Center: Subtitle Results (Expands to fill) -->
                    <center>
                        <SplitPane dividerPositions="0.4" styleClass="comparison-split">
                            <!-- Available Subtitles -->
                            <VBox spacing="10" styleClass="comparison-panel">
                                <padding>
                                    <Insets top="0" right="10" bottom="0" left="15"/>
                                </padding>
                                <Label text="Available Subtitles" styleClass="comparison-title"/>
                                <TableView fx:id="availableSubtitlesTable" VBox.vgrow="ALWAYS" styleClass="subtitle-table">
                                    <columns>
                                        <TableColumn fx:id="subtitleSelectColumn" text="" prefWidth="40"/>
                                        <TableColumn fx:id="subtitleLanguageColumn" text="Language" prefWidth="100"/>
                                        <TableColumn fx:id="subtitleProviderColumn" text="Provider" prefWidth="110"/>
                                        <TableColumn fx:id="subtitleScoreColumn" text="Score" prefWidth="70"/>
                                        <TableColumn fx:id="subtitleFormatColumn" text="Format" prefWidth="70"/>
                                    </columns>
                                    <placeholder>
                                        <Label text="No subtitles found. Click Process to search." styleClass="placeholder-label"/>
                                    </placeholder>
                                </TableView>
                            </VBox>
                            
                            <!-- Subtitle Details/Preview -->
                            <VBox spacing="10" styleClass="comparison-panel">
                                <padding>
                                    <Insets top="0" right="15" bottom="0" left="10"/>
                                </padding>
                                <Label text="Subtitle Details" styleClass="comparison-title"/>
                                <TextArea fx:id="subtitleDetailsLabel" text="Select a subtitle to view details" wrapText="true" editable="false" VBox.vgrow="ALWAYS" styleClass="details-text"/>
                            </VBox>
                        </SplitPane>
                    </center>
                    
                    <!-- Bottom: Progress Bar + Footer -->
                    <bottom>
                        <VBox spacing="10">
                            <padding>
                                <Insets top="10" right="15" bottom="15" left="15"/>
                            </padding>
                            
                            <!-- Total Progress Bar -->
                            <VBox spacing="8" styleClass="progress-section">
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="Overall Progress:" styleClass="setting-label"/>
                                    <Label fx:id="subtitleProgressStatusLabel" text="Ready" styleClass="info-label"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Label fx:id="subtitleProgressLabel" text="0 / 0 files" styleClass="stats-label"/>
                                </HBox>
                                <ProgressBar fx:id="subtitleTotalProgressBar" maxWidth="Infinity" prefHeight="8" progress="0" styleClass="total-progress-bar"/>
                            </VBox>
                            
                            <!-- Footer -->
                            <HBox spacing="15" alignment="CENTER_LEFT" styleClass="preview-footer">
                                <Label fx:id="subtitleStatsLabel" text="0 available | 0 languages" styleClass="stats-label"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Button fx:id="autoSelectBestButton" text="â­ Auto-Select Best" onAction="#handleAutoSelectBest" styleClass="secondary-button">
                                    <tooltip>
                                        <Tooltip text="Automatically select the highest-scored subtitle for each language"/>
                                    </tooltip>
                                </Button>
                                <Label text="Output Mode:" styleClass="setting-label"/>
                                <ComboBox fx:id="subtitleOutputModeCombo" styleClass="quick-combo" prefWidth="180">
                                    <tooltip>
                                        <Tooltip text="External: Save .srt file next to video (no processing)&#10;Embed: Add subtitle track inside video (fast, no re-encode)&#10;Burn-in: Permanently overlay subtitles on video (slow, re-encodes)"/>
                                    </tooltip>
                                </ComboBox>
                                <Button text="ðŸ’¾ Apply to File" onAction="#handleApplySubtitles" styleClass="primary-button" prefWidth="140">
                                    <tooltip>
                                        <Tooltip text="Apply selected subtitles to the currently selected file"/>
                                    </tooltip>
                                </Button>
                                <Button text="ðŸ”„ Batch Apply All" onAction="#handleBatchApplySubtitles" styleClass="primary-button" style="-fx-background-color: #4a9eff;" prefWidth="160">
                                    <tooltip>
                                        <Tooltip text="Apply selected subtitles to ALL files in the queue that have results"/>
                                    </tooltip>
                                </Button>
                            </HBox>
                        </VBox>
                    </bottom>
                </BorderPane>
            </VBox>
            <!-- End Subtitle Mode Layout -->
            
            <!-- Renamer Mode Layout - Full Width without right panel -->
            <VBox fx:id="renamerModeLayout" styleClass="mode-content-container" managed="false" visible="false">
                
                <!-- Main Content: Rename Preview -->
                <ScrollPane fitToWidth="true" styleClass="preview-scroll">
                    <VBox fx:id="renamePreviewContent" spacing="15" styleClass="preview-content">
                        <padding>
                            <Insets top="15" right="15" bottom="15" left="15"/>
                        </padding>
                        
                        <Label text="Rename Preview" styleClass="preview-title"/>
                        
                        <!-- Provider Selection -->
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Label text="Provider Comparison:" styleClass="setting-label"/>
                            <ComboBox fx:id="previewProviderCombo" styleClass="preview-combo" prefWidth="200"/>
                            <Region HBox.hgrow="ALWAYS"/>
                        </HBox>
                        
                        <Separator/>
                        
                        <!-- File Comparison -->
                        <SplitPane dividerPositions="0.5" VBox.vgrow="ALWAYS" styleClass="comparison-split">
                            <!-- Original Names -->
                            <VBox spacing="10" styleClass="comparison-panel">
                                <Label text="Original Filenames" styleClass="comparison-title"/>
                                <ListView fx:id="originalNamesListView" VBox.vgrow="ALWAYS" styleClass="comparison-list"/>
                            </VBox>
                            
                            <!-- Suggested Names -->
                            <VBox spacing="10" styleClass="comparison-panel">
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="Suggested Filenames" styleClass="comparison-title"/>
                                    <Label fx:id="activeProviderLabel" text="" styleClass="provider-badge"/>
                                </HBox>
                                <ListView fx:id="suggestedNamesListView" VBox.vgrow="ALWAYS" styleClass="comparison-list"/>
                            </VBox>
                        </SplitPane>
                        
                        <!-- Footer -->
                        <HBox spacing="15" alignment="CENTER_LEFT" styleClass="preview-footer">
                            <Label fx:id="renameStatsLabel" text="0 files | 0 changes" styleClass="stats-label"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <CheckBox fx:id="createBackupCheck" text="Create backup before renaming" selected="true" styleClass="preview-check"/>
                        </HBox>
                    </VBox>
                </ScrollPane>
            </VBox>
            <!-- End Renamer Mode Layout -->
            
            <!-- Settings Mode Layout -->
            <VBox fx:id="settingsModeLayout" managed="false" visible="false" styleClass="settings-mode-container">
                <padding>
                    <Insets top="16" right="16" bottom="16" left="16"/>
                </padding>
                
                <TabPane fx:id="settingsTabPane" styleClass="settings-tabs" tabClosingPolicy="UNAVAILABLE">
                    
                    <Tab text="General" styleClass="settings-tab">
                        <ScrollPane fitToWidth="true" hbarPolicy="NEVER" styleClass="settings-scroll">
                            <VBox fx:id="generalSettingsPanel" spacing="16" styleClass="settings-panel">
                                <padding>
                                    <Insets top="20" right="24" bottom="20" left="24"/>
                                </padding>
                                
                                <!-- Output Directory -->
                                <VBox spacing="10">
                                    <Label text="Output Directory" styleClass="subsection-title"/>
                                    <HBox spacing="10">
                                        <TextField fx:id="outputDirField" HBox.hgrow="ALWAYS" promptText="Same as source"/>
                                        <Button text="Browse..." onAction="#handleBrowseOutputDir" styleClass="small-button"/>
                                    </HBox>
                                    <Label text="Leave empty to save in same folder as source files" styleClass="hint-label"/>
                                </VBox>
                                
                                <Separator/>
                                
                                <!-- File Options -->
                                <VBox spacing="16">
                                    <Label text="File Handling" styleClass="subsection-title"/>
                                    <CheckBox fx:id="deleteOriginalCheck" text="Delete original files after conversion"/>
                                    <CheckBox fx:id="overwriteCheck" text="Overwrite existing files"/>
                                    <CheckBox fx:id="preserveDateCheck" text="Preserve file timestamps"/>
                                </VBox>
                                
                                <Separator/>
                                
                                <!-- Performance -->
                                <VBox spacing="10">
                                    <Label text="Performance" styleClass="subsection-title"/>
                                    <HBox spacing="12" alignment="CENTER_LEFT">
                                        <Label text="Concurrent conversions:" styleClass="setting-label"/>
                                        <Spinner fx:id="concurrentSpinner" editable="true" prefWidth="80" styleClass="settings-spinner"/>
                                        <Label text="(1-8 files)" styleClass="hint-label"/>
                                    </HBox>
                                </VBox>
                                
                                <Separator/>
                                
                                <!-- Settings Location -->
                                <VBox spacing="10">
                                    <Label text="Configuration" styleClass="subsection-title"/>
                                    <HBox spacing="10" alignment="CENTER_LEFT">
                                        <Label fx:id="settingsLocationLabel" text="Loading..." styleClass="hint-label" HBox.hgrow="ALWAYS"/>
                                        <Button fx:id="openSettingsFolderButton" text="Open Folder" onAction="#handleOpenSettingsFolder" styleClass="small-button"/>
                                    </HBox>
                                </VBox>
                            </VBox>
                        </ScrollPane>
                    </Tab>
                    
                    <Tab text="Encoding" styleClass="settings-tab">
                        <ScrollPane fitToWidth="true" hbarPolicy="NEVER" styleClass="settings-scroll">
                            <VBox fx:id="encodingSettingsPanel" spacing="16" styleClass="settings-panel">
                                <padding>
                                    <Insets top="20" right="24" bottom="20" left="24"/>
                                </padding>
                                
                                <!-- Video Settings -->
                                <VBox spacing="14">
                                    <Label text="Video" styleClass="subsection-title"/>
                                    
                                    <HBox spacing="12" alignment="CENTER_LEFT">
                                        <Label text="Format:" styleClass="setting-label" prefWidth="80"/>
                                        <ComboBox fx:id="outputFormatCombo" prefWidth="150"/>
                                        <Label text="Codec:" styleClass="setting-label" prefWidth="60"/>
                                        <ComboBox fx:id="videoCodecCombo" prefWidth="200"/>
                                    </HBox>
                                    
                                    <HBox spacing="12" alignment="CENTER_LEFT">
                                        <Label text="Preset:" styleClass="setting-label" prefWidth="80"/>
                                        <ComboBox fx:id="qualityPresetCombo" prefWidth="150"/>
                                        <Label text="Quality:" styleClass="setting-label" prefWidth="60"/>
                                        <Spinner fx:id="crfSpinner" editable="true" prefWidth="80" styleClass="settings-spinner"/>
                                        <Label text="(18-28)" styleClass="hint-label"/>
                                    </HBox>
                                    
                                    <CheckBox fx:id="hwDecodeCheck" text="Hardware-accelerated decoding"/>
                                </VBox>
                                
                                <Separator/>
                                
                                <!-- Audio Settings -->
                                <VBox spacing="14">
                                    <Label text="Audio" styleClass="subsection-title"/>
                                    
                                    <HBox spacing="12" alignment="CENTER_LEFT">
                                        <Label text="Codec:" styleClass="setting-label" prefWidth="80"/>
                                        <ComboBox fx:id="audioCodecCombo" prefWidth="150"/>
                                        <Label text="Bitrate:" styleClass="setting-label" prefWidth="60"/>
                                        <ComboBox fx:id="audioBitrateCombo" prefWidth="120"/>
                                    </HBox>
                                    
                                    <CheckBox fx:id="audioNormalizeCheck" text="Normalize volume" selected="false"/>
                                    
                                    <VBox spacing="8">
                                        <Label text="Track Selection:" styleClass="setting-label"/>
                                        <RadioButton fx:id="audioAllTracksRadio" text="All tracks" toggleGroup="$audioTrackGroup" selected="true"/>
                                        <RadioButton fx:id="audioFirstTrackRadio" text="First track only" toggleGroup="$audioTrackGroup"/>
                                        <HBox spacing="10" alignment="CENTER_LEFT">
                                            <RadioButton fx:id="audioLanguageRadio" text="By language:" toggleGroup="$audioTrackGroup"/>
                                            <TextField fx:id="audioLanguageField" promptText="eng,jpn,spa" disable="true" prefWidth="150"/>
                                        </HBox>
                                    </VBox>
                                </VBox>
                            </VBox>
                        </ScrollPane>
                    </Tab>
                    
                    <Tab text="Subtitles" styleClass="settings-tab">
                        <ScrollPane fitToWidth="true" hbarPolicy="NEVER" styleClass="settings-scroll">
                            <VBox fx:id="subtitleSettingsPanel" spacing="16" styleClass="settings-panel">
                                <padding>
                                    <Insets top="20" right="24" bottom="20" left="24"/>
                                </padding>
                                
                                <!-- Basic Settings -->
                                <VBox spacing="14">
                                    <Label text="Subtitle Processing" styleClass="subsection-title"/>
                                    
                                    <CheckBox fx:id="convertSubsCheck" text="Enable subtitle processing" selected="true"/>
                                    
                                    <HBox spacing="12" alignment="CENTER_LEFT">
                                        <Label text="Format:" styleClass="setting-label" prefWidth="80"/>
                                        <ComboBox fx:id="subtitleFormatCombo" prefWidth="150"/>
                                    </HBox>
                                </VBox>
                                
                                <Separator/>
                                
                                <!-- Whisper AI -->
                                <VBox spacing="14">
                                    <Label text="AI Generation (Whisper)" styleClass="subsection-title"/>
                                    
                                    <HBox spacing="8" style="-fx-padding: 10; -fx-background-color: rgba(76, 201, 176, 0.1); -fx-background-radius: 4;">
                                        <Label fx:id="whisperStatusLabel" text="Checking..." style="-fx-font-weight: bold; -fx-text-fill: #4ec9b0;"/>
                                    </HBox>
                                    
                                    <HBox spacing="10">
                                        <Button fx:id="setupWhisperButton" onAction="#handleSetupWhisper" text="Setup Whisper" styleClass="small-button"/>
                                        <Button fx:id="uninstallWhisperButton" onAction="#handleUninstallWhisper" text="Uninstall" styleClass="small-button" disable="true"/>
                                    </HBox>
                                    
                                    <HBox spacing="12" alignment="CENTER_LEFT">
                                        <Label text="Model:" styleClass="setting-label" prefWidth="80"/>
                                        <ComboBox fx:id="whisperModelCombo" prefWidth="150"/>
                                        <Button fx:id="downloadModelButton" onAction="#handleDownloadWhisperModel" text="Download Model" styleClass="small-button" disable="true"/>
                                    </HBox>
                                </VBox>
                                
                                <Separator/>
                                
                                <!-- Subtitle Providers -->
                                <VBox spacing="14">
                                    <Label text="Subtitle Download" styleClass="subsection-title"/>
                                    <Label text="9 providers available (General + Anime)" styleClass="hint-label"/>
                                </VBox>
                                
                                <Separator/>
                                
                                <!-- OpenSubtitles Optional Login -->
                                <VBox spacing="14">
                                    <Label text="OpenSubtitles Login (Optional)" styleClass="subsection-title"/>
                                    <Label text="Increases download limit from 5/day to 20/day" styleClass="hint-label"/>
                                    
                                    <HBox spacing="12" alignment="CENTER_LEFT">
                                        <Label text="Username:" styleClass="setting-label" prefWidth="80"/>
                                        <TextField fx:id="opensubtitlesUsernameField" promptText="Optional" prefWidth="200"/>
                                    </HBox>
                                    
                                    <HBox spacing="12" alignment="CENTER_LEFT">
                                        <Label text="Password:" styleClass="setting-label" prefWidth="80"/>
                                        <PasswordField fx:id="opensubtitlesPasswordField" promptText="Optional" prefWidth="200"/>
                                    </HBox>
                                    
                                    <HBox spacing="10">
                                        <Button fx:id="validateOpenSubsButton" onAction="#handleValidateOpenSubtitles" text="Validate" styleClass="small-button"/>
                                        <Label fx:id="openSubsValidationLabel" text="" styleClass="hint-label"/>
                                    </HBox>
                                </VBox>
                            </VBox>
                        </ScrollPane>
                    </Tab>
                    
                    <Tab text="Metadata" styleClass="settings-tab">
                        <ScrollPane fitToWidth="true" hbarPolicy="NEVER" styleClass="settings-scroll">
                            <VBox fx:id="metadataSettingsPanel" spacing="16" styleClass="settings-panel">
                                <padding>
                                    <Insets top="20" right="24" bottom="20" left="24"/>
                                </padding>
                                
                                <!-- Metadata Overview -->
                                <VBox spacing="8">
                                    <Label text="Metadata &amp; Renaming" styleClass="subsection-title"/>
                                    <Label text="Configure metadata providers for automatic file renaming" styleClass="hint-label"/>
                                    
                                    <VBox spacing="4" style="-fx-padding: 8; -fx-background-color: rgba(76, 201, 176, 0.1); -fx-background-radius: 4;">
                                        <Label text="âœ… 10 Providers Available!" style="-fx-font-weight: bold; -fx-text-fill: #4ec9b0;"/>
                                        <Label text="Free (No Key): AniDB, Kitsu, Jikan/MAL, TVmaze (4 providers)" styleClass="hint-label"/>
                                        <Label text="Requires Free API Key: TMDB, TVDB, OMDB, Trakt, Fanart.tv (5 providers)" styleClass="hint-label"/>
                                        <Label text="All are free to use - just need to register for API keys!" styleClass="hint-label" style="-fx-text-fill: #4ec9b0;"/>
                                    </VBox>
                                </VBox>
                                
                                <Separator/>
                                
                                <!-- Recommended Providers -->
                                <VBox spacing="12">
                                    <Label text="Metadata Providers (Recommended)" styleClass="subsection-title" style="-fx-font-weight: bold;"/>
                                    
                                    <VBox spacing="8">
                                        <Label text="TMDB API Key (The Movie Database):" styleClass="setting-label"/>
                                        <TextField fx:id="tmdbApiKeyField" promptText="Best for movies &amp; TV shows"/>
                                        <Label text="Get free API key from https://www.themoviedb.org/settings/api" styleClass="hint-label"/>
                                        <HBox spacing="10">
                                            <Button fx:id="validateTMDBButton" onAction="#handleValidateTMDB" text="âœ“ Validate Key" styleClass="small-button"/>
                                            <Label fx:id="tmdbValidationLabel" text="" styleClass="hint-label"/>
                                        </HBox>
                                    </VBox>
                                    
                                    <VBox spacing="8">
                                        <Label text="TVDB API Key (TheTVDB):" styleClass="setting-label"/>
                                        <TextField fx:id="tvdbApiKeyField" promptText="Best for TV show episode details"/>
                                        <Label text="Get free API key from https://thetvdb.com/api-information" styleClass="hint-label"/>
                                        <HBox spacing="10">
                                            <Button fx:id="validateTVDBButton" onAction="#handleValidateTVDB" text="âœ“ Validate Key" styleClass="small-button"/>
                                            <Label fx:id="tvdbValidationLabel" text="" styleClass="hint-label"/>
                                        </HBox>
                                    </VBox>
                                </VBox>
                                
                                <Separator/>
                                
                                <!-- Additional Providers -->
                                <VBox spacing="12">
                                    <Label text="Additional Providers (Optional)" styleClass="subsection-title"/>
                                    
                                    <VBox spacing="8">
                                        <Label text="OMDB API Key:" styleClass="setting-label"/>
                                        <TextField fx:id="omdbApiKeyField" promptText="Alternative for movies &amp; TV"/>
                                        <Label text="Get free API key from http://www.omdbapi.com/apikey.aspx" styleClass="hint-label"/>
                                        <HBox spacing="10">
                                            <Button fx:id="validateOMDBButton" onAction="#handleValidateOMDB" text="âœ“ Validate Key" styleClass="small-button"/>
                                            <Label fx:id="omdbValidationLabel" text="" styleClass="hint-label"/>
                                        </HBox>
                                    </VBox>
                                    
                                    <VBox spacing="8">
                                        <Label text="Trakt API Key:" styleClass="setting-label"/>
                                        <TextField fx:id="traktApiKeyField" promptText="Movies &amp; TV tracking"/>
                                        <Label text="Get free API key from https://trakt.tv/oauth/applications" styleClass="hint-label"/>
                                        <HBox spacing="10">
                                            <Button fx:id="validateTraktButton" onAction="#handleValidateTrakt" text="âœ“ Validate Key" styleClass="small-button"/>
                                            <Label fx:id="traktValidationLabel" text="" styleClass="hint-label"/>
                                        </HBox>
                                    </VBox>
                                    
                                    <VBox spacing="8">
                                        <Label text="Fanart.tv API Key:" styleClass="setting-label"/>
                                        <TextField fx:id="fanartApiKeyField" promptText="Media artwork and posters"/>
                                        <Label text="Get free API key from https://fanart.tv/get-an-api-key/" styleClass="hint-label"/>
                                        <Label text="Note: Fanart.tv provides media artwork. Validation coming soon." styleClass="hint-label" style="-fx-text-fill: #a0a0a0;"/>
                                    </VBox>
                                </VBox>
                                
                                <Separator/>
                                
                                <!-- Free Providers -->
                                <VBox spacing="8">
                                    <Label text="âœ… Free Providers (Always Available - No API Key Needed):" styleClass="hint-label" style="-fx-text-fill: #4ec9b0; -fx-font-weight: bold;"/>
                                    <Label text="  â€¢ AniDB - Anime metadata (movies &amp; TV)" styleClass="hint-label"/>
                                    <Label text="  â€¢ Kitsu - Anime metadata (movies &amp; TV)" styleClass="hint-label"/>
                                    <Label text="  â€¢ Jikan/MyAnimeList - Anime metadata (read-only)" styleClass="hint-label"/>
                                    <Label text="  â€¢ TVmaze - TV show metadata" styleClass="hint-label"/>
                                </VBox>
                            </VBox>
                        </ScrollPane>
                    </Tab>
                    
                    <Tab text="FFmpeg" styleClass="settings-tab">
                        <ScrollPane fitToWidth="true" hbarPolicy="NEVER" styleClass="settings-scroll">
                            <VBox fx:id="ffmpegSettingsPanel" spacing="16" styleClass="settings-panel">
                                <padding>
                                    <Insets top="20" right="24" bottom="20" left="24"/>
                                </padding>
                                
                                <!-- FFmpeg Installation Status -->
                                <VBox spacing="12">
                                    <Label text="FFmpeg Installation" styleClass="subsection-title"/>
                                    
                                    <VBox spacing="8">
                                        <Label fx:id="ffmpegVersionLabel" text="FFmpeg: Checking..." styleClass="hint-label"/>
                                        <Label text="FFmpeg is required for video encoding and processing." styleClass="hint-label" style="-fx-text-fill: #9cdcfe;"/>
                                    </VBox>
                                </VBox>
                                
                                <Separator/>
                                
                                <!-- FFmpeg Paths -->
                                <VBox spacing="12">
                                    <Label text="FFmpeg Paths" styleClass="subsection-title"/>
                                    
                                    <VBox spacing="8">
                                        <Label text="FFmpeg Path:" styleClass="setting-label"/>
                                        <HBox spacing="10">
                                            <TextField fx:id="ffmpegPathField" HBox.hgrow="ALWAYS" promptText="Automatically detected or manually specify"/>
                                            <Button text="Browse..." onAction="#handleBrowseFFmpeg" styleClass="small-button"/>
                                        </HBox>
                                    </VBox>
                                    
                                    <VBox spacing="8">
                                        <Label text="FFprobe Path:" styleClass="setting-label"/>
                                        <HBox spacing="10">
                                            <TextField fx:id="ffprobePathField" HBox.hgrow="ALWAYS" promptText="Automatically detected or manually specify"/>
                                            <Button text="Browse..." onAction="#handleBrowseFFprobe" styleClass="small-button"/>
                                        </HBox>
                                    </VBox>
                                    
                                    <HBox spacing="10" alignment="CENTER_LEFT">
                                        <Button fx:id="autoDetectButton" onAction="#handleAutoDetect" text="ðŸ” Auto-Detect FFmpeg" styleClass="small-button"/>
                                        <Button fx:id="downloadFFmpegButton" onAction="#handleDownloadFFmpeg" text="â¬‡ï¸ Download FFmpeg" styleClass="small-button"/>
                                    </HBox>
                                    
                                    <Label text="ðŸ’¡ Tip: FFmpeg is automatically downloaded on first launch. You can also manually install it and use auto-detect." styleClass="hint-label" style="-fx-text-fill: #ce9178;"/>
                                </VBox>
                            </VBox>
                        </ScrollPane>
                    </Tab>
                    
                    <Tab text="Advanced" styleClass="settings-tab">
                        <ScrollPane fitToWidth="true" hbarPolicy="NEVER" styleClass="settings-scroll">
                            <VBox fx:id="advancedSettingsPanel" spacing="16" styleClass="settings-panel">
                                <padding>
                                    <Insets top="20" right="24" bottom="20" left="24"/>
                                </padding>
                                
                                <!-- Advanced Options Placeholder -->
                                <VBox spacing="12">
                                    <Label text="Advanced Settings" styleClass="subsection-title"/>
                                    <Label text="Additional configuration options for power users" styleClass="hint-label"/>
                                </VBox>
                                
                                <Separator/>
                                
                                <!-- Additional FFmpeg Arguments -->
                                <VBox spacing="12">
                                    <Label text="Additional FFmpeg Arguments" styleClass="subsection-title"/>
                                    <Label text="Custom FFmpeg CLI arguments to append to encoding commands" styleClass="hint-label"/>
                                    
                                    <TextArea fx:id="additionalFFmpegArgsArea" promptText="e.g., -tune film -profile:v high -movflags +faststart" prefRowCount="5" minHeight="100" prefHeight="120" maxHeight="200" wrapText="true" styleClass="text-area"/>
                                    
                                    <Label text="Example: -tune film -profile:v high -movflags +faststart" styleClass="hint-label" style="-fx-font-style: italic;"/>
                                    <Label text="âš  Warning: Invalid arguments may cause encoding to fail" styleClass="hint-label" style="-fx-text-fill: #ffb900;"/>
                                </VBox>
                            </VBox>
                        </ScrollPane>
                    </Tab>
                    
                    <Tab text="About" styleClass="settings-tab">
                        <ScrollPane fitToWidth="true" hbarPolicy="NEVER" styleClass="settings-scroll">
                            <VBox fx:id="aboutSettingsPanel" spacing="16" styleClass="settings-panel" alignment="TOP_CENTER">
                                <padding>
                                    <Insets top="40" right="24" bottom="20" left="24"/>
                                </padding>
                                
                                <!-- App Icon/Logo -->
                                <ImageView fitWidth="80" fitHeight="80" preserveRatio="true">
                                    <image>
                                        <Image url="@../icons/app-icon.png"/>
                                    </image>
                                </ImageView>
                                
                                <!-- App Info -->
                                <VBox spacing="8" alignment="CENTER">
                                    <Label text="EncodeForge" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #ffffff;"/>
                                    <Label fx:id="appVersionLabel" text="Version 0.4.0" styleClass="hint-label"/>
                                    <Label text="A powerful video encoding and subtitle management tool" styleClass="hint-label" style="-fx-text-alignment: center;"/>
                                </VBox>
                                
                                <Separator style="-fx-padding: 20 0;"/>
                                
                                <!-- Features -->
                                <VBox spacing="12" maxWidth="500">
                                    <Label text="Features:" styleClass="subsection-title"/>
                                    <Label text="âœ“ Video encoding with hardware acceleration" styleClass="hint-label"/>
                                    <Label text="âœ“ Subtitle download from 9+ providers" styleClass="hint-label"/>
                                    <Label text="âœ“ AI subtitle generation with Whisper" styleClass="hint-label"/>
                                    <Label text="âœ“ Automatic file renaming with metadata" styleClass="hint-label"/>
                                    <Label text="âœ“ Batch processing with queue management" styleClass="hint-label"/>
                                </VBox>
                                
                                <Separator style="-fx-padding: 20 0;"/>
                                
                                <!-- Links -->
                                <VBox spacing="8" alignment="CENTER">
                                    <Label text="Â© 2025 EncodeForge" styleClass="hint-label"/>
                                    <Label text="Open Source â€¢ MIT License" styleClass="hint-label"/>
                                </VBox>
                            </VBox>
                        </ScrollPane>
                    </Tab>
                    
                </TabPane>
                
            </VBox>
            <!-- End Settings Mode Layout -->
            
            <!-- Logs Mode Layout -->
            <VBox fx:id="logsModeLayout" managed="false" visible="false" styleClass="logs-mode-container">
                <padding>
                    <Insets top="16" right="16" bottom="16" left="16"/>
                </padding>
                
                <VBox spacing="12" styleClass="logs-panel" VBox.vgrow="ALWAYS">
                    <padding>
                        <Insets top="16" right="20" bottom="16" left="20"/>
                    </padding>
                    
                    <!-- Header -->
                    <HBox spacing="12" alignment="CENTER_LEFT">
                        <Label text="Application Logs" styleClass="logs-title" style="-fx-font-size: 18px; -fx-font-weight: 600; -fx-text-fill: #ffffff;"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Label text="Log Level:" styleClass="info-title"/>
                        <ComboBox fx:id="logsLevelCombo" prefWidth="120" styleClass="log-level-combo"/>
                        <Button text="ðŸ“‹ Copy" onAction="#handleCopyLogs" styleClass="secondary-button"/>
                        <Button text="ðŸ—‘ï¸ Clear" onAction="#handleClearAllLogs" styleClass="secondary-button"/>
                        <Button text="ðŸ’¾ Export" onAction="#handleExportAllLogs" styleClass="primary-button"/>
                    </HBox>
                    
                    <Separator/>
                    
                    <!-- Log TextArea -->
                    <TextArea fx:id="logsTextArea" VBox.vgrow="ALWAYS" editable="false" wrapText="false" styleClass="log-area" style="-fx-font-family: 'Consolas', 'Monaco', monospace; -fx-font-size: 11px;"/>
                    
                    <!-- Footer Stats -->
                    <HBox spacing="15" alignment="CENTER_LEFT" styleClass="logs-footer">
                        <Label fx:id="logsStatsLabel" text="0 lines" styleClass="stats-label"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Label text="Auto-scroll:" styleClass="setting-label"/>
                        <CheckBox fx:id="logsAutoScrollCheck" selected="true" styleClass="auto-scroll-check"/>
                    </HBox>
                </VBox>
            </VBox>
            <!-- End Logs Mode Layout -->
            
        </StackPane>
    </center>
    
    </BorderPane>
    
    </HBox>
    
</VBox>
