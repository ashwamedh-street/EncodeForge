<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.String?>
<?import javafx.collections.FXCollections?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<VBox xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1" styleClass="root-pane">
    
    <!-- Top: Title Bar (Full Width) -->
    <HBox styleClass="custom-title-bar" alignment="CENTER_LEFT">
        <!-- App Icon and Title -->
        <HBox alignment="CENTER_LEFT" spacing="8" styleClass="title-section" onMousePressed="#handleTitleBarPressed" onMouseDragged="#handleTitleBarDragged">
            <Label fx:id="appIconLabel" styleClass="app-icon"/>
            <Label text="EncodeForge" styleClass="app-title"/>
        </HBox>
        
        <!-- Menu Bar -->
        <MenuBar styleClass="main-menu-bar" HBox.hgrow="ALWAYS" onMousePressed="#handleTitleBarPressed" onMouseDragged="#handleTitleBarDragged">
            <Menu text="File">
                <MenuItem text="Add Files..." onAction="#handleAddFiles">
                    <accelerator>
                        <javafx.scene.input.KeyCodeCombination alt="UP" code="O" control="DOWN" meta="UP" shift="UP" shortcut="UP"/>
                    </accelerator>
                </MenuItem>
                <MenuItem text="Add Folder..." onAction="#handleAddFolder">
                    <accelerator>
                        <javafx.scene.input.KeyCodeCombination alt="UP" code="O" control="DOWN" meta="UP" shift="DOWN" shortcut="UP"/>
                    </accelerator>
                </MenuItem>
                <SeparatorMenuItem/>
                <MenuItem text="Clear Queue" onAction="#handleClearQueue"/>
                <MenuItem text="Remove Selected" onAction="#handleRemoveSelected"/>
                <SeparatorMenuItem/>
                <MenuItem text="Open Output Folder" onAction="#handleOpenOutputFolder"/>
                <SeparatorMenuItem/>
                <MenuItem text="Exit" onAction="#handleExit">
                    <accelerator>
                        <javafx.scene.input.KeyCodeCombination alt="DOWN" code="F4" control="UP" meta="UP" shift="UP" shortcut="UP"/>
                    </accelerator>
                </MenuItem>
            </Menu>
            <Menu text="Edit">
                <MenuItem text="Select All" onAction="#handleSelectAll">
                    <accelerator>
                        <javafx.scene.input.KeyCodeCombination alt="UP" code="A" control="DOWN" meta="UP" shift="UP" shortcut="UP"/>
                    </accelerator>
                </MenuItem>
                <MenuItem text="Deselect All" onAction="#handleDeselectAll"/>
                <SeparatorMenuItem/>
                <MenuItem text="Settings..." onAction="#handleSettings">
                    <accelerator>
                        <javafx.scene.input.KeyCodeCombination alt="UP" code="COMMA" control="DOWN" meta="UP" shift="UP" shortcut="UP"/>
                    </accelerator>
                </MenuItem>
            </Menu>
            <Menu text="Tools">
                <MenuItem text="Batch Rename..." onAction="#handleBatchRename"/>
                <MenuItem text="Extract Subtitles..." onAction="#handleExtractSubtitles"/>
                <SeparatorMenuItem/>
                <MenuItem text="Setup AI Subtitles..." onAction="#handleConfigureWhisper"/>
                <SeparatorMenuItem/>
                <MenuItem text="Check FFmpeg Status" onAction="#handleCheckFFmpeg"/>
                <MenuItem text="Download FFmpeg" onAction="#handleDownloadFFmpeg"/>
                <SeparatorMenuItem/>
                <MenuItem text="Open Logs Folder" onAction="#handleOpenLogsFolder"/>
                <MenuItem text="Open Settings Folder" onAction="#handleOpenSettingsFolder"/>
            </Menu>
            <Menu text="Help">
                <MenuItem text="Documentation" onAction="#handleDocumentation">
                    <accelerator>
                        <javafx.scene.input.KeyCodeCombination alt="UP" code="F1" control="UP" meta="UP" shift="UP" shortcut="UP"/>
                    </accelerator>
                </MenuItem>
                <MenuItem text="View Logs" onAction="#handleViewLogs"/>
                <SeparatorMenuItem/>
                <MenuItem text="Check for Updates..." onAction="#handleCheckForUpdates"/>
                <MenuItem text="Report Issue..." onAction="#handleReportIssue"/>
                <SeparatorMenuItem/>
                <MenuItem text="About EncodeForge" onAction="#handleAbout"/>
            </Menu>
        </MenuBar>
        
        <!-- Draggable spacer area -->
        <Region HBox.hgrow="ALWAYS" onMousePressed="#handleTitleBarPressed" onMouseDragged="#handleTitleBarDragged" styleClass="draggable-spacer"/>
        
        <!-- Window Controls -->
        <HBox spacing="0" styleClass="window-controls">
            <Button fx:id="minimizeButton" onAction="#handleMinimize" styleClass="window-control-button, minimize-button"/>
            <Button fx:id="maximizeButton" onAction="#handleMaximize" styleClass="window-control-button, maximize-button"/>
            <Button fx:id="closeButton" onAction="#handleClose" styleClass="window-control-button, close-button"/>
        </HBox>
    </HBox>
    
    <!-- Main Content Area with Sidebar -->
    <HBox VBox.vgrow="ALWAYS">
        
        <!-- Left: Sidebar -->
        <VBox fx:id="sidebar" styleClass="sidebar" prefWidth="90" minWidth="80" maxWidth="100">
            <padding>
                <Insets top="15" right="10" bottom="15" left="10"/>
            </padding>
            
            <!-- Mode Selection -->
            <VBox spacing="6" styleClass="mode-selection">
                <Label text="Modes" styleClass="sidebar-section-title"/>
                
                <!-- Encoder Mode -->
                <Button fx:id="encoderModeButton" onAction="#handleEncoderMode" styleClass="mode-button, selected" maxWidth="Infinity">
                    <graphic>
                        <VBox alignment="CENTER" spacing="2">
                            <Label text="ðŸŽ¬" styleClass="mode-icon"/>
                            <Label text="Encoder" styleClass="mode-label"/>
                        </VBox>
                    </graphic>
                </Button>
                
                <!-- Subtitle Mode -->
                <Button fx:id="subtitleModeButton" onAction="#handleSubtitleMode" styleClass="mode-button" maxWidth="Infinity">
                    <graphic>
                        <VBox alignment="CENTER" spacing="2">
                            <Label text="ðŸ“" styleClass="mode-icon"/>
                            <Label text="Subtitles" styleClass="mode-label"/>
                        </VBox>
                    </graphic>
                </Button>
                
                <!-- Metadata Mode -->
                <Button fx:id="renamerModeButton" onAction="#handleRenamerMode" styleClass="mode-button" maxWidth="Infinity">
                    <graphic>
                        <VBox alignment="CENTER" spacing="2">
                            <Label text="ðŸ“" styleClass="mode-icon"/>
                            <Label text="Metadata" styleClass="mode-label"/>
                        </VBox>
                    </graphic>
                </Button>
            </VBox>
            
            <!-- Separator -->
            <Separator styleClass="sidebar-separator"/>
            
            <!-- File Operations -->
            <VBox spacing="6" styleClass="file-operations">
                <Label text="Files" styleClass="sidebar-section-title"/>
                
                <!-- Add Files -->
                <Button fx:id="addFilesButton" onAction="#handleAddFiles" styleClass="mode-button" maxWidth="Infinity">
                    <graphic>
                        <VBox alignment="CENTER" spacing="2">
                            <Label text="ðŸ“„" styleClass="mode-icon"/>
                            <Label text="Add Files" styleClass="mode-label"/>
                        </VBox>
                    </graphic>
                </Button>
                
                <!-- Add Folder -->
                <Button fx:id="addFolderButton" onAction="#handleAddFolder" styleClass="mode-button" maxWidth="Infinity">
                    <graphic>
                        <VBox alignment="CENTER" spacing="2">
                            <Label text="ðŸ“‚" styleClass="mode-icon"/>
                            <Label text="Add Folder" styleClass="mode-label"/>
                        </VBox>
                    </graphic>
                </Button>
            </VBox>
            
            <!-- Spacer to push content to top -->
            <Region VBox.vgrow="ALWAYS"/>
            
            <!-- Separator -->
            <Separator styleClass="sidebar-separator"/>
            
            <!-- Settings -->
            <VBox spacing="6" styleClass="settings-section">
                <Label text="Settings" styleClass="sidebar-section-title"/>
                
                <!-- Settings Button -->
                <Button fx:id="settingsButton" onAction="#handleSettings" styleClass="mode-button" maxWidth="Infinity">
                    <graphic>
                        <VBox alignment="CENTER" spacing="2">
                            <Label text="âš™ï¸" styleClass="mode-icon"/>
                            <Label text="Settings" styleClass="mode-label"/>
                        </VBox>
                    </graphic>
                </Button>
            </VBox>
        </VBox>
        
        <!-- Right: Main Content Area -->
        <BorderPane HBox.hgrow="ALWAYS">
        
        <!-- Top: Mode-Specific Quick Settings Panel -->
        <top>
            <VBox fx:id="modeSpecificPanel" styleClass="mode-panel">
                <!-- Encoder Quick Settings -->
                <VBox fx:id="encoderQuickSettings" spacing="10" styleClass="quick-settings" managed="false" visible="false">
                    <padding>
                        <Insets top="15" right="15" bottom="15" left="15"/>
                    </padding>
                    
                    <!-- Row 1: Video Settings -->
                    <HBox spacing="15" alignment="CENTER_LEFT">
                        <VBox spacing="4" styleClass="settings-group">
                            <Label text="Video Settings" styleClass="group-label"/>
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="Format:" styleClass="setting-label"/>
                                <ComboBox fx:id="quickFormatCombo" styleClass="quick-combo" prefWidth="100"/>
                                <Label text="Codec:" styleClass="setting-label"/>
                                <ComboBox fx:id="quickCodecCombo" styleClass="quick-combo" prefWidth="160"/>
                                <Label text="Quality:" styleClass="setting-label"/>
                                <ComboBox fx:id="quickQualityCombo" styleClass="quick-combo" prefWidth="160"/>
                                <Label text="Preset:" styleClass="setting-label"/>
                                <ComboBox fx:id="quickPresetCombo" styleClass="quick-combo" prefWidth="120"/>
                            </HBox>
                        </VBox>
                        
                        <Region HBox.hgrow="ALWAYS"/>
                        
                        <!-- Control Buttons -->
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Button fx:id="startButton" onAction="#handleStartProcessing" styleClass="toolbar-button, primary-button" disable="true" prefWidth="160"/>
                            <Button fx:id="pauseButton" onAction="#handlePause" styleClass="toolbar-button" disable="true" prefWidth="110"/>
                            <Button fx:id="stopButton" onAction="#handleStop" styleClass="toolbar-button" disable="true" prefWidth="110"/>
                            <Label fx:id="statusLabel" text="Ready" styleClass="status-label" prefWidth="150"/>
                        </HBox>
                    </HBox>
                    
                    <!-- Row 2: Processing Options -->
                    <HBox spacing="15" alignment="CENTER_LEFT">
                        <VBox spacing="6" styleClass="settings-group">
                            <Label text="Processing Options" styleClass="group-label"/>
                            <HBox spacing="15">
                                <CheckBox fx:id="quickHwAccelCheck" text="Hardware Acceleration" styleClass="quick-check" selected="true"/>
                                <CheckBox fx:id="quickAudioNormalizeCheck" text="Normalize Audio" styleClass="quick-check"/>
                                <CheckBox fx:id="quickDownloadSubsCheck" text="Download Subtitles" styleClass="quick-check" disable="true"/>
                                <CheckBox fx:id="quickRenameCheck" text="Rename Files" styleClass="quick-check" disable="true"/>
                            </HBox>
                        </VBox>
                        
                        <Separator orientation="VERTICAL"/>
                        
                        <VBox spacing="4" styleClass="settings-group">
                            <Label text="Configure" styleClass="group-label"/>
                            <HBox spacing="10">
                                <Button fx:id="configSubtitlesButton" onAction="#handleConfigureSubtitles" styleClass="small-button" prefWidth="110" disable="true"/>
                                <Button fx:id="configRenamerButton" onAction="#handleConfigureRenamer" styleClass="small-button" prefWidth="110" disable="true"/>
                            </HBox>
                        </VBox>
                    </HBox>
                </VBox>
                
                <!-- Subtitle Quick Settings -->
                <VBox fx:id="subtitleQuickSettings" spacing="10" styleClass="quick-settings" managed="false" visible="false">
                    <padding>
                        <Insets top="15" right="15" bottom="15" left="15"/>
                    </padding>
                    
                    <!-- Row 1: Mode and Language Selection -->
                    <HBox spacing="15" alignment="CENTER_LEFT">
                        <VBox spacing="4" styleClass="settings-group">
                            <Label text="Mode" styleClass="group-label"/>
                            <ComboBox fx:id="quickSubProviderCombo" styleClass="quick-combo" prefWidth="250">
                                <tooltip>
                                    <Tooltip text="Searches 10 subtitle providers:&#10;âœ… OpenSubtitles.com (API key)&#10;âœ… Addic7ed (TV shows)&#10;âœ… SubDL (Movies &amp; TV)&#10;âœ… Subf2m (Movies &amp; TV)&#10;âœ… YIFY (Movies only)&#10;âœ… Podnapisi (Multilingual)&#10;âœ… SubDivX (Spanish)&#10;ðŸŽŒ Kitsunekko (Anime - Japanese)&#10;ðŸŽŒ Jimaku (Anime - JP/EN)&#10;ðŸŽŒ AnimeSubtitles (Anime - Multi)&#10;&#10;AI generation uses Whisper"/>
                                </tooltip>
                            </ComboBox>
                        </VBox>
                        
                        <Separator orientation="VERTICAL"/>
                        
                        <VBox spacing="4" styleClass="settings-group">
                            <Label text="Languages (Select Multiple)" styleClass="group-label"/>
                            <VBox spacing="6">
                                <!-- Row 1: Major European Languages -->
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <CheckBox fx:id="langEnglishCheck" text="ðŸ‡¬ðŸ‡§ English" selected="true"/>
                                    <CheckBox fx:id="langSpanishCheck" text="ðŸ‡ªðŸ‡¸ Spanish (EU)"/>
                                    <CheckBox fx:id="langSpanishLACheck" text="ðŸ‡²ðŸ‡½ Spanish (LA)"/>
                                    <CheckBox fx:id="langFrenchCheck" text="ðŸ‡«ðŸ‡· French"/>
                                    <CheckBox fx:id="langGermanCheck" text="ðŸ‡©ðŸ‡ª German"/>
                                    <CheckBox fx:id="langItalianCheck" text="ðŸ‡®ðŸ‡¹ Italian"/>
                                    <CheckBox fx:id="langPortugueseCheck" text="ðŸ‡µðŸ‡¹ Portuguese (EU)"/>
                                    <CheckBox fx:id="langPortugueseBRCheck" text="ðŸ‡§ðŸ‡· Portuguese (BR)"/>
                                </HBox>
                                <!-- Row 2: Asian Languages -->
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <CheckBox fx:id="langJapaneseCheck" text="ðŸ‡¯ðŸ‡µ Japanese"/>
                                    <CheckBox fx:id="langChineseCheck" text="ðŸ‡¨ðŸ‡³ Chinese (Simp)"/>
                                    <CheckBox fx:id="langChineseTWCheck" text="ðŸ‡¹ðŸ‡¼ Chinese (Trad)"/>
                                    <CheckBox fx:id="langKoreanCheck" text="ðŸ‡°ðŸ‡· Korean"/>
                                    <CheckBox fx:id="langHindiCheck" text="ðŸ‡®ðŸ‡³ Hindi"/>
                                    <CheckBox fx:id="langThaiCheck" text="ðŸ‡¹ðŸ‡­ Thai"/>
                                    <CheckBox fx:id="langVietnameseCheck" text="ðŸ‡»ðŸ‡³ Vietnamese"/>
                                </HBox>
                                <!-- Row 3: Other Major Languages -->
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <CheckBox fx:id="langRussianCheck" text="ðŸ‡·ðŸ‡º Russian"/>
                                    <CheckBox fx:id="langArabicCheck" text="ðŸ‡¸ðŸ‡¦ Arabic"/>
                                    <CheckBox fx:id="langTurkishCheck" text="ðŸ‡¹ðŸ‡· Turkish"/>
                                    <CheckBox fx:id="langPolishCheck" text="ðŸ‡µðŸ‡± Polish"/>
                                    <CheckBox fx:id="langDutchCheck" text="ðŸ‡³ðŸ‡± Dutch"/>
                                    <CheckBox fx:id="langSwedishCheck" text="ðŸ‡¸ðŸ‡ª Swedish"/>
                                    <CheckBox fx:id="langNorwegianCheck" text="ðŸ‡³ðŸ‡´ Norwegian"/>
                                </HBox>
                            </VBox>
                        </VBox>
                        
                        <Region HBox.hgrow="ALWAYS"/>
                        
                        <!-- Control Buttons -->
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Button fx:id="subtitleProcessButton" onAction="#handleProcessSubtitles" styleClass="toolbar-button, primary-button" prefWidth="140"/>
                        </HBox>
                    </HBox>
                    
                    <!-- Row 2: Provider Status and Selected Files -->
                    <HBox spacing="15" alignment="CENTER_LEFT">
                        <VBox spacing="4" styleClass="settings-group">
                            <Label text="Providers" styleClass="group-label"/>
                            <HBox spacing="10">
                                <Button fx:id="whisperStatusButton" text="ðŸ¤– Whisper: Not Setup" onAction="#handleConfigureWhisper" styleClass="provider-status-button" prefWidth="180"/>
                                <Button fx:id="openSubsStatusButton" text="ðŸŒ OpenSubtitles: Not Setup" onAction="#handleConfigureOpenSubtitles" styleClass="provider-status-button" prefWidth="200"/>
                            </HBox>
                        </VBox>
                        
                        <Separator orientation="VERTICAL"/>
                        
                        <VBox spacing="4" styleClass="settings-group" HBox.hgrow="ALWAYS">
                            <Label text="Selected Files" styleClass="group-label"/>
                            <Label fx:id="subtitleSelectedFilesLabel" text="No files selected" styleClass="info-label"/>
                        </VBox>
                    </HBox>
                </VBox>
                
                <!-- Metadata Quick Settings -->
                <VBox fx:id="renamerQuickSettings" spacing="10" styleClass="quick-settings" managed="false" visible="false">
                    <padding>
                        <Insets top="15" right="15" bottom="15" left="15"/>
                    </padding>
                    
                    <!-- Row 1: Settings and Control Buttons -->
                    <HBox spacing="15" alignment="CENTER_LEFT">
                        <VBox spacing="4" styleClass="settings-group">
                            <Label text="Settings" styleClass="group-label"/>
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="Provider:" styleClass="setting-label"/>
                                <ComboBox fx:id="quickRenameProviderCombo" styleClass="quick-combo" prefWidth="150"/>
                                <Button fx:id="formatPatternButton" onAction="#handleOpenFormatter" styleClass="small-button" prefWidth="160"/>
                            </HBox>
                        </VBox>
                        
                        <Region HBox.hgrow="ALWAYS"/>
                        
                        <!-- Control Buttons -->
                        <HBox spacing="10">
                            <Button fx:id="searchMetadataButton" text="ðŸ” Search" onAction="#handleRefreshMetadata" styleClass="toolbar-button" prefWidth="130">
                                <tooltip>
                                    <Tooltip text="Search metadata providers for file information"/>
                                </tooltip>
                            </Button>
                            <Button fx:id="applyRenameButton" text="âœ… Apply Changes" onAction="#handleApplyRename" styleClass="toolbar-button, primary-button" prefWidth="160" disable="true">
                                <tooltip>
                                    <Tooltip text="Apply the rename changes to selected files"/>
                                </tooltip>
                            </Button>
                        </HBox>
                    </HBox>
                    
                    <!-- Row 2: Provider Status -->
                    <VBox spacing="8">
                        <HBox spacing="15" alignment="CENTER_LEFT">
                            <VBox spacing="4" styleClass="settings-group">
                                <Label text="API Key Providers (Free Keys)" styleClass="group-label"/>
                                <HBox spacing="10">
                                    <Button fx:id="tmdbStatusButton" onAction="#handleConfigureTMDB" styleClass="provider-status-button" prefWidth="140">
                                        <tooltip>
                                            <Tooltip text="TMDB - Movies &amp; TV shows. Click to configure API key."/>
                                        </tooltip>
                                    </Button>
                                    <Button fx:id="tvdbStatusButton" onAction="#handleConfigureTVDB" styleClass="provider-status-button" prefWidth="140">
                                        <tooltip>
                                            <Tooltip text="TVDB - TV shows only. Click to configure API key."/>
                                        </tooltip>
                                    </Button>
                                    <Button fx:id="omdbStatusButton" onAction="#handleSettings" styleClass="provider-status-button" prefWidth="140">
                                        <tooltip>
                                            <Tooltip text="OMDB - Movies &amp; TV. Click to configure API key."/>
                                        </tooltip>
                                    </Button>
                                    <Button fx:id="traktStatusButton" onAction="#handleSettings" styleClass="provider-status-button" prefWidth="140">
                                        <tooltip>
                                            <Tooltip text="Trakt - Movies &amp; TV tracking. Click to configure API key."/>
                                        </tooltip>
                                    </Button>
                                    <Button fx:id="fanartStatusButton" onAction="#handleSettings" styleClass="provider-status-button" prefWidth="140">
                                        <tooltip>
                                            <Tooltip text="Fanart.tv - Media artwork. Click to configure API key."/>
                                        </tooltip>
                                    </Button>
                                </HBox>
                            </VBox>
                            
                            <Separator orientation="VERTICAL"/>
                            
                            <VBox spacing="4" styleClass="settings-group" HBox.hgrow="ALWAYS">
                                <Label text="Selected Files" styleClass="group-label"/>
                                <Label fx:id="renamerSelectedFilesLabel" text="No files selected - add files to get started" styleClass="info-label"/>
                            </VBox>
                        </HBox>
                        
                        <HBox spacing="15" alignment="CENTER_LEFT">
                            <VBox spacing="4" styleClass="settings-group">
                                <Label text="Free Providers (No API Key)" styleClass="group-label"/>
                                <HBox spacing="10">
                                    <Label text="âœ… AniDB (Anime)" styleClass="info-label" style="-fx-text-fill: #4ec9b0; -fx-font-weight: bold;">
                                        <tooltip>
                                            <Tooltip text="AniDB - Always available, no configuration needed"/>
                                        </tooltip>
                                    </Label>
                                    <Label text="âœ… Kitsu (Anime)" styleClass="info-label" style="-fx-text-fill: #4ec9b0; -fx-font-weight: bold;">
                                        <tooltip>
                                            <Tooltip text="Kitsu - Always available, no configuration needed"/>
                                        </tooltip>
                                    </Label>
                                    <Label text="âœ… Jikan/MAL (Anime)" styleClass="info-label" style="-fx-text-fill: #4ec9b0; -fx-font-weight: bold;">
                                        <tooltip>
                                            <Tooltip text="Jikan (MyAnimeList mirror) - Always available, read-only"/>
                                        </tooltip>
                                    </Label>
                                    <Label text="âœ… TVmaze (TV)" styleClass="info-label" style="-fx-text-fill: #4ec9b0; -fx-font-weight: bold;">
                                        <tooltip>
                                            <Tooltip text="TVmaze - Always available for TV shows"/>
                                        </tooltip>
                                    </Label>
                                </HBox>
                            </VBox>
                        </HBox>
                    </VBox>
                </VBox>
            </VBox>
        </top>
    
    <!-- Center: Main Content Area -->
    <center>
        <StackPane fx:id="mainContentStack">
            
            <!-- Encoder Mode Layout -->
            <SplitPane fx:id="encoderModeLayout" dividerPositions="0.60" orientation="HORIZONTAL" styleClass="main-split-pane" managed="true" visible="true">
                
                <!-- Left Panel: Multi-Section Queue with Resizable Sections -->
                <SplitPane fx:id="queueSplitPane" orientation="VERTICAL" dividerPositions="0.4, 0.6" styleClass="queue-split-pane">
                    
                    <!-- Queued Files Section -->
                    <VBox spacing="0" styleClass="queue-section" minHeight="100">
                        <HBox alignment="CENTER_LEFT" styleClass="section-header, queued-header">
                            <Label text="Queued" styleClass="section-title"/>
                            <Label text="(Drag to reorder)" styleClass="hint-label" style="-fx-padding: 0 0 0 8;"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="queuedCountLabel" text="0 files" styleClass="queue-count"/>
                            <Separator orientation="VERTICAL" style="-fx-padding: 0 10;"/>
                            <Button fx:id="removeQueuedButton" onAction="#handleRemoveQueued" styleClass="toolbar-button" style="-fx-padding: 4 12;"/>
                            <Button fx:id="clearQueuedButton" onAction="#handleClearQueued" styleClass="toolbar-button" style="-fx-padding: 4 12;"/>
                            <padding>
                                <Insets top="8" right="12" bottom="8" left="12"/>
                            </padding>
                        </HBox>
                        
                        <TableView fx:id="queuedTable" VBox.vgrow="ALWAYS" styleClass="queue-table, draggable-table">
                            <columns>
                                <TableColumn fx:id="queuedStatusColumn" text="" prefWidth="35" minWidth="35" maxWidth="35"/>
                                <TableColumn fx:id="queuedFileColumn" text="File Name" prefWidth="300"/>
                                <TableColumn fx:id="queuedOutputColumn" text="Output" prefWidth="70"/>
                                <TableColumn fx:id="queuedSizeColumn" text="Size" prefWidth="80"/>
                            </columns>
                            <contextMenu>
                                <ContextMenu>
                                    <items>
                                        <MenuItem text="Remove" onAction="#handleRemoveQueued"/>
                                        <MenuItem text="Move Up" onAction="#handleMoveUpQueued"/>
                                        <MenuItem text="Move Down" onAction="#handleMoveDownQueued"/>
                                        <SeparatorMenuItem/>
                                        <MenuItem text="Open File Location" onAction="#handleOpenFileLocationQueued"/>
                                    </items>
                                </ContextMenu>
                            </contextMenu>
                            <placeholder>
                                <Label text="No files queued. Add files to begin encoding." styleClass="placeholder-label"/>
                            </placeholder>
                        </TableView>
                    </VBox>
                    
                    <!-- Processing Files Section -->
                    <VBox spacing="0" styleClass="queue-section" minHeight="80">
                        <HBox alignment="CENTER_LEFT" styleClass="section-header, processing-header">
                            <Label text="âš¡ Processing" styleClass="section-title"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="processingCountLabel" text="0 files" styleClass="queue-count"/>
                            <padding>
                                <Insets top="8" right="12" bottom="8" left="12"/>
                            </padding>
                        </HBox>
                        
                        <TableView fx:id="processingTable" VBox.vgrow="ALWAYS" styleClass="queue-table, processing-table">
                            <columns>
                                <TableColumn fx:id="procStatusColumn" text="" prefWidth="35" minWidth="35" maxWidth="35"/>
                                <TableColumn fx:id="procFileColumn" text="File Name" prefWidth="200"/>
                                <TableColumn fx:id="procOperationColumn" text="Status" prefWidth="150"/>
                                <TableColumn fx:id="procProgressColumn" text="Progress" prefWidth="80"/>
                                <TableColumn fx:id="procFpsColumn" text="FPS" prefWidth="60"/>
                                <TableColumn fx:id="procSpeedColumn" text="Speed" prefWidth="70"/>
                                <TableColumn fx:id="procEtaColumn" text="ETA" prefWidth="80"/>
                            </columns>
                            <placeholder>
                                <Label text="No files currently processing." styleClass="placeholder-label"/>
                            </placeholder>
                        </TableView>
                    </VBox>
                    
                    <!-- Completed Files Section -->
                    <VBox spacing="0" styleClass="queue-section" minHeight="100">
                        <HBox alignment="CENTER_LEFT" styleClass="section-header, completed-header">
                            <Label text="Completed" styleClass="section-title"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="completedCountLabel" text="0 files" styleClass="queue-count"/>
                            <Separator orientation="VERTICAL" style="-fx-padding: 0 10;"/>
                            <Button fx:id="clearCompletedButton" onAction="#handleClearCompleted" styleClass="toolbar-button" style="-fx-padding: 4 12;"/>
                            <padding>
                                <Insets top="8" right="12" bottom="8" left="12"/>
                            </padding>
                        </HBox>
                        
                        <TableView fx:id="completedTable" VBox.vgrow="ALWAYS" styleClass="queue-table, completed-table">
                            <columns>
                                <TableColumn fx:id="compStatusColumn" text="" prefWidth="35" minWidth="35" maxWidth="35"/>
                                <TableColumn fx:id="compFileColumn" text="File Name" prefWidth="250"/>
                                <TableColumn fx:id="compOutputColumn" text="Output" prefWidth="70"/>
                                <TableColumn fx:id="compSizeColumn" text="Original" prefWidth="80"/>
                                <TableColumn fx:id="compNewSizeColumn" text="New Size" prefWidth="80"/>
                                <TableColumn fx:id="compTimeColumn" text="Time Taken" prefWidth="90"/>
                            </columns>
                            <contextMenu>
                                <ContextMenu>
                                    <items>
                                        <MenuItem text="Open Output File" onAction="#handleOpenOutputFile"/>
                                        <MenuItem text="Open File Location" onAction="#handleOpenFileLocationCompleted"/>
                                        <SeparatorMenuItem/>
                                        <MenuItem text="Remove from List" onAction="#handleRemoveCompleted"/>
                                    </items>
                                </ContextMenu>
                            </contextMenu>
                            <placeholder>
                                <Label text="No files completed yet." styleClass="placeholder-label"/>
                            </placeholder>
                        </TableView>
                    </VBox>
                </SplitPane>
            
            <!-- Right Panel: File Info and Preview -->
            <HBox styleClass="encoder-panel-wrapper">
                <!-- Toggle Button (Always Visible) -->
                <VBox styleClass="toggle-button-bar" alignment="TOP_CENTER">
                    <Button fx:id="encoderLogToggleButton" text="â—€" onAction="#handleToggleEncoderLogs" styleClass="panel-toggle-button">
                        <tooltip>
                            <Tooltip text="Hide panel"/>
                        </tooltip>
                    </Button>
                </VBox>
                
                <!-- Collapsible Panel Content -->
                <VBox fx:id="encoderRightPanel" styleClass="right-panel-container" HBox.hgrow="ALWAYS" managed="true" visible="true">
                    <TabPane fx:id="rightPanelTabs" tabClosingPolicy="UNAVAILABLE" styleClass="info-tab-pane" VBox.vgrow="ALWAYS" managed="true" visible="true">
                    
                    <!-- File Info Tab -->
                    <Tab fx:id="fileInfoTab" text="File Info" closable="false">
                        <ScrollPane fitToWidth="true" styleClass="info-scroll">
                            <VBox spacing="15" styleClass="tab-content">
                                <padding>
                                    <Insets top="15" right="15" bottom="15" left="15"/>
                                </padding>
                                
                                <!-- File Details -->
                                <VBox spacing="10">
                                    <Label text="File Details" styleClass="section-subtitle"/>
                                    <Label fx:id="fileInfoLabel" text="Select a file to view details" styleClass="file-info-text" wrapText="true"/>
                                </VBox>
                                
                                <!-- Media Information -->
                                <VBox fx:id="mediaInfoSection" spacing="10" managed="false" visible="false">
                                    <Label text="Media Information" styleClass="section-subtitle"/>
                                    <VBox spacing="5">
                                        <Label text="Video Tracks:" styleClass="info-title"/>
                                        <ListView fx:id="videoTracksListView" prefHeight="100" styleClass="track-list"/>
                                    </VBox>
                                    <VBox spacing="5">
                                        <Label text="Audio Tracks:" styleClass="info-title"/>
                                        <ListView fx:id="audioTracksListView" prefHeight="100" styleClass="track-list"/>
                                    </VBox>
                                    <VBox spacing="5">
                                        <Label text="Subtitle Tracks:" styleClass="info-title"/>
                                        <ListView fx:id="subtitleTracksListView" prefHeight="100" styleClass="track-list"/>
                                    </VBox>
                                </VBox>
                            </VBox>
                        </ScrollPane>
                    </Tab>
                    
                    <!-- Logs Tab -->
                    <Tab fx:id="logsTab" text="ðŸ“‹ Logs" closable="false">
                        <VBox spacing="10" styleClass="tab-content">
                            <padding>
                                <Insets top="10" right="10" bottom="10" left="10"/>
                            </padding>
                            
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="Log Level:" styleClass="info-title"/>
                                <ComboBox fx:id="logLevelComboBox" styleClass="log-level-combo"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Button text="Clear" onAction="#handleClearLogs" styleClass="small-button"/>
                                <Button text="Export" onAction="#handleExportLogs" styleClass="small-button"/>
                            </HBox>
                            
                            <TextArea fx:id="logTextArea" VBox.vgrow="ALWAYS" editable="false" wrapText="false" styleClass="log-area"/>
                        </VBox>
                    </Tab>
                    
                </TabPane>
                </VBox>
            </HBox>
            </SplitPane>
            <!-- End Encoder Mode Layout -->
            
            <!-- Subtitle Mode Layout -->
            <SplitPane fx:id="subtitleModeLayout" dividerPositions="0.75" orientation="HORIZONTAL" styleClass="main-split-pane" managed="false" visible="false">
                
                <!-- Main Content: Subtitle Preview -->
                <BorderPane styleClass="subtitle-main-content">
                    <!-- Top: Header Section -->
                    <top>
                        <VBox spacing="10">
                            <padding>
                                <Insets top="15" right="15" bottom="10" left="15"/>
                            </padding>
                            
                            <Label text="Subtitle Preview" styleClass="preview-title"/>
                            
                            <!-- File Selector -->
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="Current File:" styleClass="setting-label"/>
                                <ComboBox fx:id="subtitleFileCombo" styleClass="preview-combo" prefWidth="400" HBox.hgrow="ALWAYS"/>
                            </HBox>
                            
                            <Separator/>
                        </VBox>
                    </top>
                    
                    <!-- Center: Subtitle Results (Expands to fill) -->
                    <center>
                        <SplitPane dividerPositions="0.4" styleClass="comparison-split">
                            <!-- Available Subtitles -->
                            <VBox spacing="10" styleClass="comparison-panel">
                                <padding>
                                    <Insets top="0" right="10" bottom="0" left="15"/>
                                </padding>
                                <Label text="Available Subtitles" styleClass="comparison-title"/>
                                <TableView fx:id="availableSubtitlesTable" VBox.vgrow="ALWAYS" styleClass="subtitle-table">
                                    <columns>
                                        <TableColumn fx:id="subtitleSelectColumn" text="" prefWidth="40"/>
                                        <TableColumn fx:id="subtitleLanguageColumn" text="Language" prefWidth="100"/>
                                        <TableColumn fx:id="subtitleProviderColumn" text="Provider" prefWidth="110"/>
                                        <TableColumn fx:id="subtitleScoreColumn" text="Score" prefWidth="70"/>
                                        <TableColumn fx:id="subtitleFormatColumn" text="Format" prefWidth="70"/>
                                    </columns>
                                    <placeholder>
                                        <Label text="No subtitles found. Click Process to search." styleClass="placeholder-label"/>
                                    </placeholder>
                                </TableView>
                            </VBox>
                            
                            <!-- Subtitle Details/Preview -->
                            <VBox spacing="10" styleClass="comparison-panel">
                                <padding>
                                    <Insets top="0" right="15" bottom="0" left="10"/>
                                </padding>
                                <Label text="Subtitle Details" styleClass="comparison-title"/>
                                <TextArea fx:id="subtitleDetailsLabel" text="Select a subtitle to view details" wrapText="true" editable="false" VBox.vgrow="ALWAYS" styleClass="details-text"/>
                            </VBox>
                        </SplitPane>
                    </center>
                    
                    <!-- Bottom: Progress Bar + Footer -->
                    <bottom>
                        <VBox spacing="10">
                            <padding>
                                <Insets top="10" right="15" bottom="15" left="15"/>
                            </padding>
                            
                            <!-- Total Progress Bar -->
                            <VBox spacing="8" styleClass="progress-section">
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="Overall Progress:" styleClass="setting-label"/>
                                    <Label fx:id="subtitleProgressStatusLabel" text="Ready" styleClass="info-label"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Label fx:id="subtitleProgressLabel" text="0 / 0 files" styleClass="stats-label"/>
                                </HBox>
                                <ProgressBar fx:id="subtitleTotalProgressBar" maxWidth="Infinity" prefHeight="8" progress="0" styleClass="total-progress-bar"/>
                            </VBox>
                            
                            <!-- Footer -->
                            <HBox spacing="15" alignment="CENTER_LEFT" styleClass="preview-footer">
                                <Label fx:id="subtitleStatsLabel" text="0 available | 0 languages" styleClass="stats-label"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Button fx:id="autoSelectBestButton" text="â­ Auto-Select Best" onAction="#handleAutoSelectBest" styleClass="secondary-button">
                                    <tooltip>
                                        <Tooltip text="Automatically select the highest-scored subtitle for each language"/>
                                    </tooltip>
                                </Button>
                                <Label text="Output Mode:" styleClass="setting-label"/>
                                <ComboBox fx:id="subtitleOutputModeCombo" styleClass="quick-combo" prefWidth="180">
                                    <tooltip>
                                        <Tooltip text="External: Save .srt file next to video (no processing)&#10;Embed: Add subtitle track inside video (fast, no re-encode)&#10;Burn-in: Permanently overlay subtitles on video (slow, re-encodes)"/>
                                    </tooltip>
                                </ComboBox>
                                <Button text="ðŸ’¾ Apply to File" onAction="#handleApplySubtitles" styleClass="primary-button" prefWidth="140">
                                    <tooltip>
                                        <Tooltip text="Apply selected subtitles to the currently selected file"/>
                                    </tooltip>
                                </Button>
                                <Button text="ðŸ”„ Batch Apply All" onAction="#handleBatchApplySubtitles" styleClass="primary-button" style="-fx-background-color: #4a9eff;" prefWidth="160">
                                    <tooltip>
                                        <Tooltip text="Apply selected subtitles to ALL files in the queue that have results"/>
                                    </tooltip>
                                </Button>
                            </HBox>
                        </VBox>
                    </bottom>
                </BorderPane>
                
                <!-- Sidebar: Logs Only -->
                <HBox styleClass="subtitle-panel-wrapper">
                    <!-- Toggle Button (Always Visible) -->
                    <VBox styleClass="toggle-button-bar" alignment="TOP_CENTER">
                        <Button fx:id="subtitleLogToggleButton" text="â—€" onAction="#handleToggleSubtitleLogs" styleClass="panel-toggle-button">
                            <tooltip>
                                <Tooltip text="Hide panel"/>
                            </tooltip>
                        </Button>
                    </VBox>
                    
                    <!-- Collapsible Panel Content -->
                    <VBox fx:id="subtitleRightPanel" styleClass="right-panel-container" HBox.hgrow="ALWAYS" managed="true" visible="true">
                        <TabPane fx:id="subtitleLogsTabPane" tabClosingPolicy="UNAVAILABLE" styleClass="info-tab-pane" VBox.vgrow="ALWAYS" managed="true" visible="true">
                        <Tab text="ðŸ“‹ Logs" closable="false">
                            <VBox spacing="10" styleClass="tab-content">
                                <padding>
                                    <Insets top="10" right="10" bottom="10" left="10"/>
                                </padding>
                                
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="Log Level:" styleClass="info-title"/>
                                    <ComboBox fx:id="subtitleLogLevelCombo" styleClass="log-level-combo"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Button text="Clear" onAction="#handleClearLogs" styleClass="small-button"/>
                                    <Button text="Export" onAction="#handleExportLogs" styleClass="small-button"/>
                                </HBox>
                                
                                <TextArea fx:id="subtitleLogArea" VBox.vgrow="ALWAYS" editable="false" wrapText="false" styleClass="log-area"/>
                            </VBox>
                        </Tab>
                    </TabPane>
                    </VBox>
                </HBox>
            </SplitPane>
            <!-- End Subtitle Mode Layout -->
            
            <!-- Renamer Mode Layout -->
            <SplitPane fx:id="renamerModeLayout" dividerPositions="0.75" orientation="HORIZONTAL" styleClass="main-split-pane" managed="false" visible="false">
                
                <!-- Main Content: Rename Preview -->
                <ScrollPane fitToWidth="true" styleClass="preview-scroll">
                    <VBox fx:id="renamePreviewContent" spacing="15" styleClass="preview-content">
                        <padding>
                            <Insets top="15" right="15" bottom="15" left="15"/>
                        </padding>
                        
                        <Label text="Rename Preview" styleClass="preview-title"/>
                        
                        <!-- Provider Selection -->
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Label text="Provider Comparison:" styleClass="setting-label"/>
                            <ComboBox fx:id="previewProviderCombo" styleClass="preview-combo" prefWidth="200"/>
                            <Region HBox.hgrow="ALWAYS"/>
                        </HBox>
                        
                        <Separator/>
                        
                        <!-- File Comparison -->
                        <SplitPane dividerPositions="0.5" VBox.vgrow="ALWAYS" styleClass="comparison-split">
                            <!-- Original Names -->
                            <VBox spacing="10" styleClass="comparison-panel">
                                <Label text="Original Filenames" styleClass="comparison-title"/>
                                <ListView fx:id="originalNamesListView" VBox.vgrow="ALWAYS" styleClass="comparison-list"/>
                            </VBox>
                            
                            <!-- Suggested Names -->
                            <VBox spacing="10" styleClass="comparison-panel">
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="Suggested Filenames" styleClass="comparison-title"/>
                                    <Label fx:id="activeProviderLabel" text="" styleClass="provider-badge"/>
                                </HBox>
                                <ListView fx:id="suggestedNamesListView" VBox.vgrow="ALWAYS" styleClass="comparison-list"/>
                            </VBox>
                        </SplitPane>
                        
                        <!-- Footer -->
                        <HBox spacing="15" alignment="CENTER_LEFT" styleClass="preview-footer">
                            <Label fx:id="renameStatsLabel" text="0 files | 0 changes" styleClass="stats-label"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <CheckBox fx:id="createBackupCheck" text="Create backup before renaming" selected="true" styleClass="preview-check"/>
                        </HBox>
                    </VBox>
                </ScrollPane>
                
                <!-- Sidebar: Logs Only -->
                <HBox styleClass="renamer-panel-wrapper">
                    <!-- Toggle Button (Always Visible) -->
                    <VBox styleClass="toggle-button-bar" alignment="TOP_CENTER">
                        <Button fx:id="renamerLogToggleButton" text="â—€" onAction="#handleToggleRenamerLogs" styleClass="panel-toggle-button">
                            <tooltip>
                                <Tooltip text="Hide panel"/>
                            </tooltip>
                        </Button>
                    </VBox>
                    
                    <!-- Collapsible Panel Content -->
                    <VBox fx:id="renamerRightPanel" styleClass="right-panel-container" HBox.hgrow="ALWAYS" managed="true" visible="true">
                        <TabPane fx:id="renamerLogsTabPane" tabClosingPolicy="UNAVAILABLE" styleClass="info-tab-pane" VBox.vgrow="ALWAYS" managed="true" visible="true">
                        <Tab text="ðŸ“‹ Logs" closable="false">
                            <VBox spacing="10" styleClass="tab-content">
                                <padding>
                                    <Insets top="10" right="10" bottom="10" left="10"/>
                                </padding>
                                
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="Log Level:" styleClass="info-title"/>
                                    <ComboBox fx:id="renamerLogLevelCombo" styleClass="log-level-combo"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Button text="Clear" onAction="#handleClearLogs" styleClass="small-button"/>
                                    <Button text="Export" onAction="#handleExportLogs" styleClass="small-button"/>
                                </HBox>
                                
                                <TextArea fx:id="renamerLogArea" VBox.vgrow="ALWAYS" editable="false" wrapText="false" styleClass="log-area"/>
                            </VBox>
                        </Tab>
                    </TabPane>
                    </VBox>
                </HBox>
            </SplitPane>
            <!-- End Renamer Mode Layout -->
            
        </StackPane>
    </center>
    
    </BorderPane>
    
    </HBox>
    
</VBox>
