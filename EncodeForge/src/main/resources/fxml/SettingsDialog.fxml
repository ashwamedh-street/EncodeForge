<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<StackPane xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1">
    <!-- Main Content -->
    <BorderPane styleClass="dialog-pane" prefWidth="700" prefHeight="600">
        
        <!-- Custom Title Bar -->
        <top>
            <HBox styleClass="custom-title-bar" alignment="CENTER_LEFT">
                <!-- App Icon and Title -->
                <HBox alignment="CENTER_LEFT" spacing="8" styleClass="title-section" onMousePressed="#handleTitleBarPressed" onMouseDragged="#handleTitleBarDragged">
                    <Label fx:id="appIconLabel" styleClass="app-icon"/>
                    <Label text="Settings" styleClass="app-title"/>
                </HBox>
                
                <!-- Draggable spacer area -->
                <Region HBox.hgrow="ALWAYS" onMousePressed="#handleTitleBarPressed" onMouseDragged="#handleTitleBarDragged" styleClass="draggable-spacer"/>
                
                <!-- Window Controls -->
                <HBox spacing="0" styleClass="window-controls">
                    <Button fx:id="minimizeButton" onAction="#handleMinimize" styleClass="window-control-button, minimize-button"/>
                    <Button fx:id="maximizeButton" onAction="#handleMaximize" styleClass="window-control-button, maximize-button"/>
                    <Button fx:id="closeButton" onAction="#handleClose" styleClass="window-control-button, close-button"/>
                </HBox>
            </HBox>
        </top>
    
    <!-- Left: Settings Categories -->
    <left>
        <ListView fx:id="categoryList" styleClass="category-list" prefWidth="180"/>
    </left>
    
    <!-- Center: Settings Content -->
    <center>
        <ScrollPane fitToWidth="true" styleClass="settings-content-scroll">
            <VBox fx:id="settingsContent" spacing="0" styleClass="settings-content">
                <padding>
                    <Insets top="20" right="20" bottom="20" left="20"/>
                </padding>
                
                <!-- General Settings -->
                <VBox fx:id="generalSettings" spacing="20" styleClass="settings-category">
                    <Label text="General Settings" styleClass="category-title"/>
                    
                    <VBox spacing="10">
                        <Label text="Settings Location:" styleClass="setting-label"/>
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Label fx:id="settingsLocationLabel" text="~/.encodeforge/settings.json" styleClass="hint-label" HBox.hgrow="ALWAYS"/>
                            <Button fx:id="openSettingsFolderButton" onAction="#handleOpenSettingsFolder" styleClass="small-button"/>
                        </HBox>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="10">
                        <Label text="Default Output Directory:" styleClass="setting-label"/>
                        <HBox spacing="10">
                            <TextField fx:id="outputDirField" HBox.hgrow="ALWAYS" promptText="Same as source"/>
                            <Button text="Browse..." onAction="#handleBrowseOutputDir" styleClass="small-button"/>
                        </HBox>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="12">
                        <Label text="Options:" styleClass="subsection-title"/>
                        <CheckBox fx:id="deleteOriginalCheck" text="Delete original files after successful conversion"/>
                        <CheckBox fx:id="overwriteCheck" text="Overwrite existing output files"/>
                        <CheckBox fx:id="preserveDateCheck" text="Preserve file creation/modification dates"/>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="10">
                        <Label text="Concurrent Conversions:" styleClass="setting-label"/>
                        <Spinner fx:id="concurrentSpinner" editable="true" min="1" max="8" initialValue="1" prefWidth="100"/>
                    </VBox>
                </VBox>
                
                <!-- FFmpeg Settings -->
                <VBox fx:id="ffmpegSettings" spacing="20" styleClass="settings-category" visible="false" managed="false">
                    <Label text="FFmpeg Configuration" styleClass="category-title"/>
                    
                    <VBox spacing="12">
                        <Label text="Status:" styleClass="subsection-title"/>
                        <Label fx:id="ffmpegVersionLabel" text="Checking..." styleClass="version-label"/>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="10">
                        <Label text="FFmpeg Path:" styleClass="setting-label"/>
                        <HBox spacing="10">
                            <TextField fx:id="ffmpegPathField" HBox.hgrow="ALWAYS" promptText="Auto-detect"/>
                            <Button text="Browse..." onAction="#handleBrowseFFmpeg" styleClass="small-button"/>
                        </HBox>
                        <Label text="Leave empty for automatic detection" styleClass="hint-label"/>
                    </VBox>
                    
                    <VBox spacing="10">
                        <Label text="FFprobe Path:" styleClass="setting-label"/>
                        <HBox spacing="10">
                            <TextField fx:id="ffprobePathField" HBox.hgrow="ALWAYS" promptText="Auto-detect"/>
                            <Button text="Browse..." onAction="#handleBrowseFFprobe" styleClass="small-button"/>
                        </HBox>
                        <Label text="Usually in the same folder as FFmpeg" styleClass="hint-label"/>
                    </VBox>
                    
                    <Separator/>
                    
                    <HBox spacing="12">
                        <Button fx:id="autoDetectButton" onAction="#handleAutoDetect" styleClass="primary-button"/>
                        <Button fx:id="downloadFFmpegButton" onAction="#handleDownloadFFmpeg" styleClass="secondary-button"/>
                    </HBox>
                </VBox>
                
                <!-- Video Settings -->
                <VBox fx:id="videoSettings" spacing="15" styleClass="settings-category" visible="false" managed="false">
                    <Label text="Video Encoding" styleClass="category-title"/>
                    
                    <VBox spacing="8">
                        <Label text="Output Format:" styleClass="setting-label"/>
                        <ComboBox fx:id="outputFormatCombo" maxWidth="Infinity"/>
                    </VBox>
                    
                    <VBox spacing="8">
                        <Label text="Video Codec:" styleClass="setting-label"/>
                        <ComboBox fx:id="videoCodecCombo" maxWidth="Infinity"/>
                    </VBox>
                    
                    <CheckBox fx:id="hwDecodeCheck" text="Enable hardware-accelerated decoding (GPU)"/>
                    
                    <VBox spacing="8">
                        <Label text="Quality Preset:" styleClass="setting-label"/>
                        <ComboBox fx:id="qualityPresetCombo" maxWidth="Infinity"/>
                    </VBox>
                    
                    <VBox spacing="8">
                        <Label text="CRF/CQ Value (Lower = Better Quality):" styleClass="setting-label"/>
                        <Spinner fx:id="crfSpinner" editable="true" min="0" max="51" initialValue="23"/>
                    </VBox>
                </VBox>
                
                <!-- Audio Settings -->
                <VBox fx:id="audioSettings" spacing="20" styleClass="settings-category" visible="false" managed="false">
                    <Label text="Audio Configuration" styleClass="category-title"/>
                    
                    <VBox spacing="10">
                        <Label text="Audio Codec:" styleClass="setting-label"/>
                        <ComboBox fx:id="audioCodecCombo" maxWidth="Infinity"/>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="12">
                        <Label text="Audio Track Selection:" styleClass="subsection-title"/>
                        <RadioButton fx:id="audioAllTracksRadio" text="Keep all audio tracks" toggleGroup="$audioTrackGroup" selected="true"/>
                        <RadioButton fx:id="audioFirstTrackRadio" text="Keep first track only" toggleGroup="$audioTrackGroup"/>
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <RadioButton fx:id="audioLanguageRadio" text="Keep by language:" toggleGroup="$audioTrackGroup"/>
                            <TextField fx:id="audioLanguageField" promptText="e.g., eng,jpn,spa" disable="true" prefWidth="200"/>
                        </HBox>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="10">
                        <Label text="Audio Bitrate:" styleClass="setting-label"/>
                        <ComboBox fx:id="audioBitrateCombo" maxWidth="Infinity"/>
                    </VBox>
                </VBox>
                
                <!-- Subtitle Settings -->
                <VBox fx:id="subtitleSettings" spacing="20" styleClass="settings-category" visible="false" managed="false">
                    <Label text="Subtitle Configuration" styleClass="category-title"/>
                    <Label text="Configure subtitle download, generation, and embedding options" styleClass="hint-label"/>
                    
                    <VBox spacing="12">
                        <CheckBox fx:id="convertSubsCheck" text="Convert/embed subtitles during encoding" selected="true"/>
                        
                        <VBox spacing="10">
                            <Label text="Subtitle Format:" styleClass="setting-label"/>
                            <ComboBox fx:id="subtitleFormatCombo" maxWidth="Infinity"/>
                            <Label text="Format used when embedding or converting subtitles" styleClass="hint-label"/>
                        </VBox>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="12">
                        <Label text="AI Subtitle Generation (Whisper)" styleClass="subsection-title"/>
                        <Label text="Generate subtitles using OpenAI Whisper AI when none are available" styleClass="hint-label"/>
                        
                        <VBox spacing="10">
                            <VBox spacing="8">
                                <Label text="Whisper Model:" styleClass="setting-label"/>
                                <ComboBox fx:id="whisperModelCombo" maxWidth="Infinity"/>
                                <Label text="Larger models are more accurate but slower. 'base' is recommended for most users." styleClass="hint-label"/>
                            </VBox>
                        </VBox>
                    </VBox>
                    
                    <Separator/>
                    
        <VBox spacing="12">
            <Label text="Subtitle Download Providers" styleClass="subsection-title"/>
            <Label text="Download subtitles from 9 providers including specialized anime sources. All work without configuration!" styleClass="hint-label"/>
            
            <VBox spacing="4" style="-fx-padding: 8; -fx-background-color: rgba(76, 201, 176, 0.1); -fx-background-radius: 4;">
                <Label text="✅ 9 Providers Available (Including Anime Support!):" style="-fx-font-weight: bold; -fx-text-fill: #4ec9b0;"/>
                <Label text="General Providers:" style="-fx-font-weight: bold; -fx-text-fill: #4ec9b0; -fx-padding: 4 0 0 0;"/>
                <Label text="  • OpenSubtitles.com - 60+ languages, free API (5 downloads/day)" styleClass="hint-label"/>
                <Label text="  • Addic7ed - Movies, TV shows, and anime" styleClass="hint-label"/>
                <Label text="  • SubDL - Movies and TV shows with free API" styleClass="hint-label"/>
                <Label text="  • Subf2m - Movies and TV shows" styleClass="hint-label"/>
                <Label text="  • YIFY Subtitles - Movies only" styleClass="hint-label"/>
                <Label text="  • Podnapisi - All content types, multilingual" styleClass="hint-label"/>
                <Label text="  • SubDivX - Spanish subtitles only" styleClass="hint-label"/>
                <Label text="Anime Providers:" style="-fx-font-weight: bold; -fx-text-fill: #ce9178; -fx-padding: 4 0 0 0;"/>
                <Label text="  • Kitsunekko - Anime subtitles (English &amp; Japanese)" styleClass="hint-label"/>
                <Label text="  • Jimaku - Anime only, multilingual support" styleClass="hint-label"/>
            </VBox>
            
            <Separator/>
                        
                         <Label text="OpenSubtitles.com Login (Optional - Higher Limits)" styleClass="setting-label" style="-fx-font-weight: bold;"/>
                        <VBox spacing="8">
                            <VBox spacing="4" style="-fx-padding: 8; -fx-background-color: rgba(76, 201, 176, 0.1); -fx-background-radius: 4;">
                                <Label text="ℹ️  Login is Optional but Recommended" style="-fx-font-weight: bold; -fx-text-fill: #4ec9b0;"/>
                                <Label text="• Without login: 5 downloads/day per IP (Consumer API limits)" styleClass="hint-label"/>
                                <Label text="• With login: 20 downloads/day per user account (4x more!)" styleClass="hint-label"/>
                                <Label text="• Create free account: https://www.opensubtitles.com" styleClass="hint-label" style="-fx-text-fill: #4ec9b0;"/>
                                <Label text="• VIP accounts get 200 downloads/day" styleClass="hint-label"/>
                            </VBox>
                            <Label text="Username (Optional):" styleClass="setting-label"/>
                            <TextField fx:id="opensubtitlesUsernameField" promptText="Your OpenSubtitles username (optional)"/>
                            <Label text="Password (Optional):" styleClass="setting-label"/>
                            <PasswordField fx:id="opensubtitlesPasswordField" promptText="Your OpenSubtitles password (optional)"/>
                        </VBox>
                        
                        <HBox spacing="10">
                            <Button fx:id="validateOpenSubsButton" onAction="#handleValidateOpenSubtitles" styleClass="small-button"/>
                            <Label fx:id="openSubsValidationLabel" text="" styleClass="hint-label"/>
                        </HBox>
                        
                        <Separator/>
                        
                        <Label text="All Other Providers (No Configuration Needed)" styleClass="setting-label" style="-fx-font-weight: bold;"/>
                        <Label text="✅ The remaining 8 providers work automatically without any setup:" styleClass="hint-label" style="-fx-text-fill: #4ec9b0;"/>
                        <Label text="  • Addic7ed - Movies, TV, Anime (search &amp; download)" styleClass="hint-label"/>
                        <Label text="  • SubDL, Subf2m, YIFY - General content (search &amp; download)" styleClass="hint-label"/>
                        <Label text="  • Podnapisi - Multilingual support (search &amp; download)" styleClass="hint-label"/>
                        <Label text="  • SubDivX - Spanish content (search &amp; download)" styleClass="hint-label"/>
                        <Label text="  • Kitsunekko, Jimaku - Anime specialists (search &amp; download)" styleClass="hint-label"/>
                    </VBox>
                </VBox>
                
                <!-- Metadata Settings (New) -->
                <VBox fx:id="metadataSettings" spacing="20" styleClass="settings-category" visible="false" managed="false">
                    <Label text="Metadata &amp; Renaming" styleClass="category-title"/>
                    <Label text="Configure metadata providers for automatic file renaming" styleClass="hint-label"/>
                    
                    <VBox spacing="4" style="-fx-padding: 8; -fx-background-color: rgba(76, 201, 176, 0.1); -fx-background-radius: 4;">
                        <Label text="✅ 10 Providers Available!" style="-fx-font-weight: bold; -fx-text-fill: #4ec9b0;"/>
                        <Label text="Free (No Key): AniList, Kitsu, Jikan/MAL, TVmaze (4 providers)" styleClass="hint-label"/>
                        <Label text="Requires Free API Key: TMDB, TVDB, OMDB, Trakt, Fanart.tv (5 providers)" styleClass="hint-label"/>
                        <Label text="All are free to use - just need to register for API keys!" styleClass="hint-label" style="-fx-text-fill: #4ec9b0;"/>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="12">
                        <Label text="Metadata Providers (Recommended)" styleClass="subsection-title" style="-fx-font-weight: bold;"/>
                        
                        <VBox spacing="8">
                            <Label text="TMDB API Key (The Movie Database):" styleClass="setting-label"/>
                            <TextField fx:id="tmdbApiKeyField" promptText="Best for movies &amp; TV shows"/>
                            <Label text="Get free API key from https://www.themoviedb.org/settings/api" styleClass="hint-label"/>
                            <HBox spacing="10">
                                <Button fx:id="validateTMDBButton" onAction="#handleValidateTMDB" styleClass="small-button"/>
                                <Label fx:id="tmdbValidationLabel" text="" styleClass="hint-label"/>
                            </HBox>
                        </VBox>
                        
                        <VBox spacing="8">
                            <Label text="TVDB API Key (TheTVDB):" styleClass="setting-label"/>
                            <TextField fx:id="tvdbApiKeyField" promptText="Best for TV show episode details"/>
                            <Label text="Get free API key from https://thetvdb.com/api-information" styleClass="hint-label"/>
                            <HBox spacing="10">
                                <Button fx:id="validateTVDBButton" onAction="#handleValidateTVDB" styleClass="small-button"/>
                                <Label fx:id="tvdbValidationLabel" text="" styleClass="hint-label"/>
                            </HBox>
                        </VBox>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="12">
                        <Label text="Additional Providers (Optional)" styleClass="subsection-title"/>
                        
                        <VBox spacing="8">
                            <Label text="OMDB API Key:" styleClass="setting-label"/>
                            <TextField fx:id="omdbApiKeyField" promptText="Alternative for movies &amp; TV"/>
                            <Label text="Get free API key from http://www.omdbapi.com/apikey.aspx" styleClass="hint-label"/>
                            <HBox spacing="10">
                                <Button fx:id="validateOMDBButton" onAction="#handleValidateOMDB" styleClass="small-button"/>
                                <Label fx:id="omdbValidationLabel" text="" styleClass="hint-label"/>
                            </HBox>
                        </VBox>
                        
                        <VBox spacing="8">
                            <Label text="Trakt API Key:" styleClass="setting-label"/>
                            <TextField fx:id="traktApiKeyField" promptText="Movies &amp; TV tracking"/>
                            <Label text="Get free API key from https://trakt.tv/oauth/applications" styleClass="hint-label"/>
                            <HBox spacing="10">
                                <Button fx:id="validateTraktButton" onAction="#handleValidateTrakt" styleClass="small-button"/>
                                <Label fx:id="traktValidationLabel" text="" styleClass="hint-label"/>
                            </HBox>
                        </VBox>
                        
                        <VBox spacing="8">
                            <Label text="Fanart.tv API Key:" styleClass="setting-label"/>
                            <TextField fx:id="fanartApiKeyField" promptText="Media artwork and posters"/>
                            <Label text="Get free API key from https://fanart.tv/get-an-api-key/" styleClass="hint-label"/>
                            <Label text="Note: Fanart.tv provides media artwork. Validation coming soon." styleClass="hint-label" style="-fx-text-fill: #a0a0a0;"/>
                        </VBox>
                        
                        <Label text="✅ Free Providers (Always Available - No API Key Needed):" styleClass="hint-label" style="-fx-text-fill: #4ec9b0; -fx-font-weight: bold;"/>
                        <Label text="  • AniList - Anime metadata (movies &amp; TV)" styleClass="hint-label"/>
                        <Label text="  • Kitsu - Anime metadata (movies &amp; TV)" styleClass="hint-label"/>
                        <Label text="  • Jikan/MyAnimeList - Anime metadata (read-only)" styleClass="hint-label"/>
                        <Label text="  • TVmaze - TV show metadata" styleClass="hint-label"/>
                    </VBox>
                    
                    <Separator/>
                    
                    <VBox spacing="12">
                        <Label text="Format Patterns" styleClass="subsection-title"/>
                        <Label text="Customize how renamed files are formatted" styleClass="hint-label"/>
                        
                        <VBox spacing="8">
                            <Label text="TV Show Pattern:" styleClass="setting-label"/>
                            <TextField fx:id="tvShowPatternField" promptText="{title} - S{season}E{episode} - {episodeTitle}"/>
                            <Label text="Example: Breaking Bad - S01E01 - Pilot" styleClass="hint-label"/>
                        </VBox>
                        
                        <VBox spacing="8">
                            <Label text="Movie Pattern:" styleClass="setting-label"/>
                            <TextField fx:id="moviePatternField" promptText="{title} ({year})"/>
                            <Label text="Example: Inception (2010)" styleClass="hint-label"/>
                        </VBox>
                        
                        <VBox spacing="8">
                            <Label text="Anime Pattern:" styleClass="setting-label"/>
                            <TextField fx:id="animePatternField" promptText="{title} - {episode} - {episodeTitle}"/>
                            <Label text="Example: Naruto - 001 - Episode Title" styleClass="hint-label"/>
                        </VBox>
                        
                        <Button fx:id="openPatternEditorButton" onAction="#handleOpenPatternEditor" text="Open Pattern Editor" styleClass="secondary-button"/>
                        <Label text="Available tokens: {title}, {year}, {season}, {episode}, {episodeTitle}, {S}, {E}" styleClass="hint-label"/>
                    </VBox>
                </VBox>
                
                <!-- Output Settings -->
                <VBox fx:id="outputSettings" spacing="15" styleClass="settings-category" visible="false" managed="false">
                    <Label text="Output Settings" styleClass="category-title"/>
                    <Label text="Configure output file handling and metadata options" styleClass="hint-label"/>
                    
                    <VBox spacing="12">
                        <Label text="File Metadata" styleClass="subsection-title"/>
                        <CheckBox fx:id="copyMetadataCheck" text="Copy metadata from source file" selected="true"/>
                        <Label text="Preserve title, language, and other metadata tags" styleClass="hint-label"/>
                        <CheckBox fx:id="stripMetadataCheck" text="Strip unnecessary metadata"/>
                        <Label text="Remove creation date, encoding software tags, and other non-essential metadata" styleClass="hint-label"/>
                    </VBox>
                </VBox>
                
                <!-- Advanced Settings -->
                <VBox fx:id="advancedSettings" spacing="15" styleClass="settings-category" visible="false" managed="false">
                    <Label text="Advanced Options" styleClass="category-title"/>
                    
                    <VBox spacing="8">
                        <Label text="Custom FFmpeg Arguments:" styleClass="setting-label"/>
                        <TextArea fx:id="customArgsArea" promptText="Additional FFmpeg arguments (advanced users only)" prefRowCount="3"/>
                    </VBox>
                    
                    <CheckBox fx:id="twoPassCheck" text="Enable two-pass encoding (slower, better quality)"/>
                    <CheckBox fx:id="fastStartCheck" text="Enable fast start for web playback" selected="true"/>
                    
                    <VBox spacing="8">
                        <Label text="Thread Count:" styleClass="setting-label"/>
                        <Spinner fx:id="threadSpinner" editable="true" min="0" max="32" initialValue="0"/>
                        <Label text="0 = Auto-detect" styleClass="hint-label"/>
                    </VBox>
                </VBox>
                
            </VBox>
        </ScrollPane>
    </center>
    
    <!-- Bottom: Action Buttons -->
    <bottom>
        <HBox spacing="10" alignment="CENTER_RIGHT" styleClass="dialog-buttons">
            <padding>
                <Insets top="15" right="15" bottom="15" left="15"/>
            </padding>
            <Button text="Restore Defaults" onAction="#handleRestoreDefaults" styleClass="secondary-button"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button text="Cancel" onAction="#handleCancel" styleClass="secondary-button"/>
            <Button text="Apply" onAction="#handleApply" styleClass="primary-button"/>
            <Button text="OK" onAction="#handleOK" styleClass="primary-button" defaultButton="true"/>
        </HBox>
    </bottom>
    
    </BorderPane>
</StackPane>

